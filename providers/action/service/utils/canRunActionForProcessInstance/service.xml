<sequence xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
		disabled="false"
		id="043ad68b5a2647ea9a5ef822e8e6eed2"
		lineNumber="1">
	<steps xsi:type="be.nabu.libs.services.vm.step.Map"
			disabled="false"
			id="9312488a938446ad875392e067ee1912"
			lineNumber="2">
		<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
				disabled="false"
				id="9f672f5cc21f489ca62b62f0d1e2fa8d"
				serviceId="nabu.frameworks.process.crud.processInstance.services.get"
				resultName="result0247c421ab2242a5a1f50314553cdcbe"
				temporaryMapping="true"
				x="98"
				y="44"
				invocationOrder="0"
				asynchronous="false"
				recache="false">
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="9239fc0ef7594eefb804950b472d3199"
					mask="false"
					optional="false"
					fixedValue="false">
				<from>input/processInstanceId</from>
				<to>id</to>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="861fbf26ad8f4944acd6b11dc9a23783"
					mask="false"
					optional="false"
					fixedValue="false">
				<from>input/connectionId</from>
				<to>connectionId</to>
			</steps>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Link"
				disabled="false"
				id="46be9bff43a84624a9a13c4cecf83a0a"
				mask="false"
				optional="false"
				fixedValue="false">
			<from>result0247c421ab2242a5a1f50314553cdcbe/result</from>
			<to>potentialProcessInstance</to>
		</steps>
	</steps>
	<steps xsi:type="be.nabu.libs.services.vm.step.Sequence"
			comment="Any state other than RUNNING does not allow running of actions. If in ERROR, it first needs to be resolved before continuing. All other states (apart from RUNNING) are final."
			disabled="false"
			id="277215429a6b43a6950dfd5461ecf101"
			label="potentialProcessInstance/processState != &quot;RUNNING&quot;"
			lineNumber="3">
		<steps xsi:type="be.nabu.libs.services.vm.step.Map"
				comment="Map output"
				disabled="false"
				id="f5695a01eaeb4c4cab5c1ffadc500adf"
				lineNumber="4">
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="9a2eb6af632d4b4d956c90beae1d4164"
					mask="false"
					optional="false"
					fixedValue="true">
				<from>=potentialProcessInstance/processState == "ERROR"</from>
				<to>output/processInError</to>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="0bc9f75a8ca54a17b6a0794339634d23"
					mask="false"
					optional="false"
					fixedValue="true">
				<from>false</from>
				<to>output/allowedToProceed</to>
			</steps>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Break"
				disabled="false"
				id="ee685fe4dd4049b79e1a2ecc9f6eb3b2"
				lineNumber="5">
			<count>2</count>
		</steps>
	</steps>
	<steps xsi:type="be.nabu.libs.services.vm.step.Sequence"
			disabled="true"
			id="05491419c3f64f95b7baee49351e7795"
			label="potentialProcessInstance/processState == &quot;ERROR&quot;"
			lineNumber="6">
		<steps xsi:type="be.nabu.libs.services.vm.step.Map"
				comment="Map output"
				disabled="false"
				id="208dfd57fd204829883044b887fa26e5"
				lineNumber="7">
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="17ea0558d01147f0ae35c2e7f046341d"
					mask="false"
					optional="false"
					fixedValue="true">
				<from>true</from>
				<to>output/processInError</to>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="a34db4d49a914da4ad2dcf751b8e866b"
					mask="false"
					optional="false"
					fixedValue="true">
				<from>false</from>
				<to>output/allowedToProceed</to>
			</steps>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Break"
				disabled="false"
				id="0c891d966a0048fea0208c0074525935"
				lineNumber="8">
			<count>2</count>
		</steps>
	</steps>
	<steps xsi:type="be.nabu.libs.services.vm.step.Map"
			comment="Get all state for the process so we can evaluate conditions"
			disabled="false"
			id="38a5beb02a0b4eb59f20e836f6b81fac"
			lineNumber="9">
		<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
				disabled="false"
				id="b8cf0c6283ad45bfa945514a603b3256"
				serviceId="nabu.frameworks.process.crud.processData.services.list"
				resultName="resultbf9d7fc5f70a4fb9b34e4bd173582cf6"
				temporaryMapping="true"
				x="202"
				y="54"
				invocationOrder="0"
				asynchronous="false"
				recache="false">
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="053b91acbdb946e9ab452d16922e402c"
					mask="false"
					optional="false"
					fixedValue="true">
				<from>true</from>
				<to>filter/active</to>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="892df7339a2e44f8a765808aec89c535"
					mask="false"
					optional="false"
					fixedValue="false">
				<from>input/processInstanceId</from>
				<to>filter/processInstanceId[0]</to>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="561ff938f95d43b3a5b731f052734183"
					mask="false"
					optional="false"
					fixedValue="false">
				<from>input/connectionId</from>
				<to>connectionId</to>
			</steps>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Link"
				disabled="false"
				id="6a20fbf67f8540aa90151d6637ce1f11"
				mask="false"
				optional="false"
				fixedValue="false">
			<from>resultbf9d7fc5f70a4fb9b34e4bd173582cf6/results</from>
			<to>allInstanceData</to>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
				disabled="false"
				id="1725e069df944617adcf252f8d6e26e9"
				serviceId="nabu.frameworks.process.providers.action.service.utils.getProcessDefinition"
				resultName="result923dc8a516494fb695779fd94b99f6c0"
				temporaryMapping="true"
				x="156"
				y="159"
				invocationOrder="0"
				asynchronous="false"
				recache="false">
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="c37fd0e8c4aa4eb6950a86fad3eb627f"
					mask="false"
					optional="false"
					fixedValue="false">
				<from>input/processVersionId</from>
				<to>processVersionId</to>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="fad53ba2eab54d1794f13860c8fc919e"
					mask="false"
					optional="false"
					fixedValue="false">
				<from>input/connectionId</from>
				<to>connectionId</to>
			</steps>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Link"
				disabled="false"
				id="c20e36d21c174a79aceda28a72869152"
				mask="false"
				optional="false"
				fixedValue="false">
			<from>result923dc8a516494fb695779fd94b99f6c0/definition</from>
			<to>definition</to>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Link"
				disabled="false"
				id="2804a6f7adfb494bb28146e2964b8e8a"
				mask="false"
				optional="false"
				fixedValue="false">
			<from>result923dc8a516494fb695779fd94b99f6c0/definition/states/actions[id == /input/actionId]</from>
			<to>potentialAction</to>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Link"
				disabled="false"
				id="95c17f3affe8416bb5aab1e1db0560ac"
				mask="false"
				optional="false"
				fixedValue="false">
			<from>result923dc8a516494fb695779fd94b99f6c0/definition/actionRelations[actionId == /input/actionId || targetActionId == /input/actionId]</from>
			<to>potentialRelations</to>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Link"
				disabled="false"
				id="938740c6f7444fc78aee816f61da69a6"
				mask="false"
				optional="false"
				fixedValue="false">
			<from>result923dc8a516494fb695779fd94b99f6c0/definition/stateRelations[actionId == /input/actionId &amp;&amp; relationType == "flow-initial"]</from>
			<to>potentialStateRelations</to>
		</steps>
	</steps>
	<steps xsi:type="be.nabu.libs.services.vm.step.Map"
			disabled="false"
			id="5ef9b863bd4f4bfd87a0d6a8ea5fe44e"
			label="allInstanceData"
			lineNumber="10">
		<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
				disabled="false"
				id="065e60295b544a7ba57540c9001b101a"
				serviceId="nabu.utils.List.toMap"
				resultName="result1d25df01660c4336a21e1aa88f9c6538"
				temporaryMapping="true"
				x="294"
				y="148"
				invocationOrder="0"
				asynchronous="false"
				recache="false">
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="45e8d225ec444e53898b3ab02c908909"
					mask="false"
					optional="false"
					fixedValue="false">
				<from>allInstanceData</from>
				<to>list</to>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="ca8954bd4a694e2d97ea479c8bb12852"
					mask="false"
					optional="false"
					fixedValue="true">
				<from>name</from>
				<to>keyField</to>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="059921deeb2943f38b4c61ba71d8cdbc"
					mask="false"
					optional="false"
					fixedValue="true">
				<from>value</from>
				<to>valueField</to>
			</steps>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Link"
				disabled="false"
				id="780d92bba4ca40b093459505c08bd9dc"
				mask="false"
				optional="false"
				fixedValue="false">
			<from>result1d25df01660c4336a21e1aa88f9c6538/map</from>
			<to>instanceDataMap</to>
		</steps>
	</steps>
	<steps xsi:type="be.nabu.libs.services.vm.step.Sequence"
			comment="Do an additional check"
			disabled="false"
			id="af45a491ce454c1eb69d5a4db92f7812"
			label="potentialAction/stateCondition != null &amp;&amp; input/data != null"
			lineNumber="11">
		<steps xsi:type="be.nabu.libs.services.vm.step.Map"
				disabled="false"
				id="ad824375c7074fc38ea69e98007fbd9b"
				lineNumber="12">
			<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
					disabled="false"
					id="1b21198ad9e44db3921656b2150c53b1"
					serviceId="nabu.services.glue.Services.evaluate"
					resultName="resultd033a07dcf2c4e1ab27c16286f8b6c22"
					temporaryMapping="true"
					x="58"
					y="47"
					invocationOrder="0"
					asynchronous="false"
					recache="false">
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="1933b3645abc43c48284ebbbcb06b9e0"
						mask="false"
						optional="false"
						fixedValue="false">
					<from>potentialAction/stateCondition</from>
					<to>rule</to>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="c52aaf46632d4f999d7e40fb8ac76a64"
						mask="false"
						optional="false"
						fixedValue="false">
					<from>instanceDataMap</from>
					<to>context[0]</to>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="dad2cd3e89734229902ed7b921ec282e"
						mask="false"
						optional="false"
						fixedValue="false">
					<from>input/data</from>
					<to>context[1]</to>
				</steps>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="f5b72d9e592042eb905e84ab6bb48bb0"
					mask="false"
					optional="false"
					fixedValue="false">
				<from>resultd033a07dcf2c4e1ab27c16286f8b6c22/response</from>
				<to>conditionResult</to>
			</steps>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Sequence"
				disabled="false"
				id="623350be03694c29a503afe624b9e731"
				label="!conditionResult"
				lineNumber="13">
			<steps xsi:type="be.nabu.libs.services.vm.step.Map"
					comment="Not allowed to proceed"
					disabled="false"
					id="8e0a2a6526714a0aa6df5f5aeed06050"
					lineNumber="14">
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="529a144a17044a3b94f44c05e8ccc3cf"
						mask="false"
						optional="false"
						fixedValue="true">
					<from>false</from>
					<to>output/allowedToProceed</to>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="9cc2c76488664692be4939380506dad0"
						mask="false"
						optional="false"
						fixedValue="true">
					<from>false</from>
					<to>output/processInError</to>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="23df165ac53c4a478d357f132678b1fe"
						mask="false"
						optional="false"
						fixedValue="true">
					<from>false</from>
					<to>output/nested</to>
				</steps>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Break"
					disabled="false"
					id="0152ae32e43f4db58ae9d765165d63f5"
					lineNumber="15">
				<count>3</count>
			</steps>
		</steps>
	</steps>
	<steps xsi:type="be.nabu.libs.services.vm.step.Map"
			disabled="false"
			id="391b7bb837ed436aaebf467ed737f87e"
			lineNumber="16">
		<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
				disabled="false"
				id="cf0b3d196ce14e95aa377dc05c471d3d"
				serviceId="nabu.utils.String.split"
				resultName="resultcfe636d1c1274c4aa11386097eeca7bf"
				temporaryMapping="true"
				x="191"
				y="338"
				invocationOrder="0"
				asynchronous="false"
				recache="false">
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="91af9b43e2fe41f8a56de6c5e40631a7"
					mask="false"
					optional="false"
					fixedValue="true">
				<from>RUNNING,ERROR,SUCCEEDED,FAILED</from>
				<to>string</to>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="49850ded2596461798d663a780434efd"
					mask="false"
					optional="false"
					fixedValue="true">
				<from>,</from>
				<to>separator</to>
			</steps>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Link"
				disabled="false"
				id="6bbdbf21d291415c94d34e5e46010f7a"
				mask="false"
				optional="false"
				fixedValue="false">
			<from>resultcfe636d1c1274c4aa11386097eeca7bf/parts</from>
			<to>actionStates</to>
		</steps>
	</steps>
	<steps xsi:type="be.nabu.libs.services.vm.step.For"
			disabled="false"
			id="a706eb0bb536493592a5315b0f12c72d"
			lineNumber="17"
			variable="relationToCheck"
			into="applicableRelations">
		<steps xsi:type="be.nabu.libs.services.vm.step.Sequence"
				comment="If we are the target, check the source. If it is an initializer, we ignore it. @2025-10-10: initializers are now logged as instances so we can check them"
				disabled="true"
				id="1e155036a641450db3e71d0d8682683e"
				label="relationToCheck/targetActionId == input/actionId"
				lineNumber="18">
			<steps xsi:type="be.nabu.libs.services.vm.step.Map"
					comment="Get source action"
					disabled="false"
					id="f05b4401e43247fc88b4d779df9d79f8"
					lineNumber="19">
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="eb588cbed2f14ee9a93627df5b980677"
						mask="false"
						optional="false"
						fixedValue="false">
					<from>definition/states/actions[id == /relationToCheck/actionId]</from>
					<to>sourceAction</to>
				</steps>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Break"
					disabled="false"
					id="5dd2f3ed30924617823db49af4c24795"
					label="sourceAction/actionType == &quot;initializer&quot;"
					lineNumber="20">
				<count>2</count>
				<continueExecution>true</continueExecution>
			</steps>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Switch"
				disabled="false"
				id="62bd62187b654d3aad86a8c6b9ff685f"
				lineNumber="21"
				query="relationToCheck/condition">
			<steps xsi:type="be.nabu.libs.services.vm.step.Map"
					comment="Always allowed"
					disabled="false"
					id="9340dbe9feb44cdcb1a1e888fb935421"
					label="null"
					lineNumber="22">
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="a211691a6178424f86f2381364f26bf2"
						mask="false"
						optional="false"
						fixedValue="false">
					<from>relationToCheck</from>
					<to>applicableRelations[0]</to>
				</steps>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Sequence"
					comment="Check condition"
					disabled="false"
					id="cea9e1b588db458395a6e91c745e0b20"
					lineNumber="23">
				<steps xsi:type="be.nabu.libs.services.vm.step.Map"
						disabled="false"
						id="33d616ee15214c40862c3d2f615e65e6"
						lineNumber="24">
					<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
							disabled="false"
							id="4c996fc81df2447b8e0426d3e05c0096"
							serviceId="nabu.services.glue.Services.evaluate"
							resultName="result95599a59565f41bd8262be53ecb95561"
							temporaryMapping="true"
							x="196"
							y="196"
							invocationOrder="0"
							asynchronous="false"
							recache="false">
						<steps xsi:type="be.nabu.libs.services.vm.step.Link"
								disabled="false"
								id="b061335d04cf436bb2bb9c68b169a220"
								mask="false"
								optional="false"
								fixedValue="false">
							<from>relationToCheck/condition</from>
							<to>rule</to>
						</steps>
						<steps xsi:type="be.nabu.libs.services.vm.step.Link"
								disabled="false"
								id="19d041217fc44435878c6659490eb974"
								mask="false"
								optional="false"
								fixedValue="false">
							<from>instanceDataMap</from>
							<to>context[0]</to>
						</steps>
					</steps>
					<steps xsi:type="be.nabu.libs.services.vm.step.Link"
							disabled="false"
							id="5d7154a36cb843f98ec553b4834357f0"
							mask="false"
							optional="false"
							fixedValue="false">
						<from>result95599a59565f41bd8262be53ecb95561/response</from>
						<to>conditionResult</to>
					</steps>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Map"
						disabled="false"
						id="a601cc90f91240b4ad27a91363c887e3"
						label="conditionResult"
						lineNumber="25">
					<steps xsi:type="be.nabu.libs.services.vm.step.Link"
							disabled="false"
							id="d795c1494f064919a9b832f3ea4cbe8f"
							mask="false"
							optional="false"
							fixedValue="false">
						<from>relationToCheck</from>
						<to>applicableRelations[0]</to>
					</steps>
				</steps>
			</steps>
		</steps>
		<query>potentialRelations</query>
	</steps>
	<steps xsi:type="be.nabu.libs.services.vm.step.Map"
			comment="Get incoming relations and outgoing relations and any process instance already flagged during this run"
			disabled="false"
			id="bfc78793d44a4d868e2bd6badeab5b6a"
			lineNumber="26">
		<steps xsi:type="be.nabu.libs.services.vm.step.Link"
				disabled="false"
				id="ab402ac87f2a4fbeaedd5477fd6ee389"
				mask="false"
				optional="false"
				fixedValue="false">
			<from>applicableRelations[targetActionId == /potentialAction/id &amp;&amp; (relationType == "flow" || relationType == "flow-start" || relationType == "flow-failed")]</from>
			<to>incomingFlows</to>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Link"
				disabled="false"
				id="59432212b7af4b7d90cb7d0af817067a"
				mask="false"
				optional="false"
				fixedValue="false">
			<from>applicableRelations[actionId == /potentialAction/id &amp;&amp; (relationType == "flow" || relationType == "flow-stop" || relationType == "flow-failed") ]</from>
			<to>outgoingFlows</to>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Link"
				disabled="false"
				id="4045d172f5d74420aed1d7bc7e8dc689"
				mask="false"
				optional="false"
				fixedValue="true">
			<from>false</from>
			<to>output/allowedToProceed</to>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Link"
				disabled="false"
				id="e0a2e9c0035c4d3c8e84adcb698d79ce"
				mask="false"
				optional="false"
				fixedValue="false">
			<from>potentialRelations[actionId == /potentialAction/id &amp;&amp; (relationType == "flow" || relationType == "flow-stop" || relationType == "flow-failed")]</from>
			<to>potentialOutgoingFlows</to>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Link"
				disabled="false"
				id="dfe9a183d4184628923c7ce23c82dd16"
				mask="false"
				optional="false"
				fixedValue="false">
			<from>potentialRelations[targetActionId == /potentialAction/id &amp;&amp; (relationType == "flow" || relationType == "flow-start" || relationType == "flow-failed")]</from>
			<to>potentialIncomingFlows</to>
		</steps>
	</steps>
	<steps xsi:type="be.nabu.libs.services.vm.step.Map"
			comment="For reset actions, outgoing flows don't count"
			disabled="false"
			id="72c5f99b267d455a9e45edfe99647ad6"
			label="potentialAction/actionType == &quot;reset&quot;"
			lineNumber="27">
		<steps xsi:type="be.nabu.libs.services.vm.step.Drop"
				disabled="false"
				id="37c08dfad8ab44248acaa3bb5574fab7"
				path="outgoingFlows[0]" xsi:nil="true"/>
	</steps>
	<steps xsi:type="be.nabu.libs.services.vm.step.Map"
			comment="Set the maxOccurs to 0 by default (makes it easier later)"
			disabled="false"
			id="6690f9744fbe4510a061b68d4232032a"
			label="potentialAction/maxOccurs == null"
			lineNumber="28">
		<steps xsi:type="be.nabu.libs.services.vm.step.Link"
				disabled="false"
				id="be3cf3cee7c940c9820f5fe9320261ba"
				mask="false"
				optional="false"
				fixedValue="true">
			<from>0</from>
			<to>potentialAction/maxOccurs</to>
		</steps>
	</steps>
	<steps xsi:type="be.nabu.libs.services.vm.step.Sequence"
			comment="First we check that the state matches"
			disabled="false"
			id="b125befa9bae416f887dee7034f5519e"
			label="potentialAction/processStateId == potentialProcessInstance/currentStateId"
			lineNumber="29">
		<steps xsi:type="be.nabu.libs.services.vm.step.Throw"
				disabled="false"
				features="PROCESS_STATE_REQUIRE_INITIAL_FLOW"
				id="dbf62357806f4acc99c43ee4b82bbe88"
				label="potentialIncomingFlows == null &amp;&amp; potentialStateRelations == null"
				lineNumber="30"
				message="An action has no incoming flows nor any state relations"
				whitelist="false" xsi:nil="true"/>
		<steps xsi:type="be.nabu.libs.services.vm.step.Map"
				disabled="false"
				id="a3f5de39d0b54aac8674d885618cd47b"
				lineNumber="31">
			<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
					disabled="false"
					id="3117149237f746b58a87dd46adfba27a"
					serviceId="nabu.frameworks.process.crud.processStateInstance.services.list"
					resultName="result9bd7fdb465ab4b668152bb1796888d7e"
					temporaryMapping="true"
					x="74"
					y="76"
					invocationOrder="0"
					asynchronous="false"
					recache="false">
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="d6ec2fb36e6948fa9411b160efeb5e15"
						mask="false"
						optional="false"
						fixedValue="true">
					<from>true</from>
					<to>filter/running</to>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="c48a28f3cf3f4f76ae71bb2ccae2e21b"
						mask="false"
						optional="false"
						fixedValue="false">
					<from>potentialProcessInstance/id</from>
					<to>filter/processInstanceId[0]</to>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="da71ac14f47e4836a376b60488a9e6e9"
						mask="false"
						optional="false"
						fixedValue="false">
					<from>potentialProcessInstance/currentStateId</from>
					<to>filter/processStateId[0]</to>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="4cfedab0d019473295b1e887c509b483"
						mask="false"
						optional="false"
						fixedValue="false">
					<from>input/connectionId</from>
					<to>connectionId</to>
				</steps>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="d464c9eb713f414185226e764cd26b60"
					mask="false"
					optional="false"
					fixedValue="false">
				<from>result9bd7fdb465ab4b668152bb1796888d7e/results[0]</from>
				<to>currentStateInstance</to>
			</steps>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Throw"
				disabled="false"
				id="6de4076808dd4bef879b0045a8cc9ce7"
				label="!currentStateInstance"
				lineNumber="32"
				message="Could not find state instance"
				whitelist="false" xsi:nil="true"/>
		<steps xsi:type="be.nabu.libs.services.vm.step.Map"
				comment="Get all the related action instances for this process instance"
				disabled="false"
				id="3d46cc2fb3c44d4eb8f1d8f462aaf683"
				lineNumber="33">
			<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
					disabled="false"
					id="e8cee927c2d6412a9fa0b2d07e5a95cc"
					serviceId="nabu.utils.List.addAll"
					resultName="resultc227324d99cb4da09e66eff1ccffc101"
					temporaryMapping="true"
					x="22"
					y="136"
					invocationOrder="0"
					asynchronous="false"
					recache="false">
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="270d6fc366ef4c6793d67ce4e0ab392b"
						mask="false"
						optional="false"
						fixedValue="false">
					<from>applicableRelations/targetActionId</from>
					<to>list</to>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="ba4f2e3738f64a8ca1ff8fbd032929be"
						mask="false"
						optional="false"
						fixedValue="false">
					<from>applicableRelations/actionId</from>
					<to>objects</to>
				</steps>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
					disabled="false"
					id="a3aea7acc2f1479db2b04ab2ae8dfbe7"
					serviceId="nabu.utils.List.unique"
					resultName="resulta010982be9ba4ef9b38ee4a035c0a018"
					temporaryMapping="true"
					x="123"
					y="294"
					invocationOrder="1"
					asynchronous="false"
					recache="false">
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="1cdc2b2d1938424dbc9772687f952a1b"
						mask="false"
						optional="false"
						fixedValue="false">
					<from>resultc227324d99cb4da09e66eff1ccffc101/list</from>
					<to>list</to>
				</steps>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
					disabled="false"
					id="e49ed47c0b8646d8976baf008f11a15f"
					serviceId="nabu.frameworks.process.crud.processActionInstance.services.list"
					resultName="result7ba151e534b847cf8c1df4e3f492a6fd"
					temporaryMapping="true"
					x="519"
					y="44"
					invocationOrder="2"
					asynchronous="false"
					recache="false">
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="feebcea7a97b4ae3a9c8764055a33198"
						mask="false"
						optional="false"
						fixedValue="false">
					<from>resulta010982be9ba4ef9b38ee4a035c0a018/list</from>
					<to>filter/processActionId</to>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="85b58e44c8264b539fa7b5b0753cf6d6"
						mask="false"
						optional="false"
						fixedValue="false">
					<from>input/processInstanceId</from>
					<to>filter/processInstanceId[0]</to>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="bea678dec8f84a6ba0c17d1e85c23abf"
						mask="false"
						optional="false"
						fixedValue="false">
					<from>actionStates</from>
					<to>filter/processState</to>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="9b608f2529bc44fea47924a158d979ce"
						mask="false"
						optional="false"
						fixedValue="false">
					<from>currentStateInstance/id</from>
					<to>filter/processStateInstanceId[0]</to>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="1ef0629ebc944e3a96b153c9481f7097"
						mask="false"
						optional="false"
						fixedValue="false">
					<from>input/connectionId</from>
					<to>connectionId</to>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="d4dd0582450c4602866d7bb30df0b5bc"
						fixedValue="true">
					<from>false</from>
					<to>filter/reset</to>
				</steps>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="f7f72defffa94a6f926c56656349aa94"
					mask="false"
					optional="false"
					fixedValue="false">
				<from>result7ba151e534b847cf8c1df4e3f492a6fd/results</from>
				<to>relatedActionInstances</to>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="87ac0eaf6ed741e0941444cabbe4191d"
					mask="false"
					optional="false"
					fixedValue="true">
				<from>true</from>
				<to>allowedToProceed</to>
			</steps>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Sequence"
				comment="There should only really be one potential state relation. If the condition results in &quot;false&quot;, execution is not allowed"
				disabled="false"
				id="54d8bf3637d945cda063bae6f1505ea8"
				label="allowedToProceed &amp;&amp; potentialStateRelations"
				lineNumber="34">
			<steps xsi:type="be.nabu.libs.services.vm.step.Map"
					disabled="false"
					id="1c83e778aae64da19e0bf983078433d2"
					lineNumber="35">
				<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
						disabled="false"
						id="47004796e45a416c81efb54b3d437701"
						serviceId="nabu.utils.List.size"
						resultName="result25d1c29546fc4411a6e9f7701935d4e0"
						temporaryMapping="true"
						x="136"
						y="99"
						invocationOrder="0"
						asynchronous="false"
						recache="false">
					<steps xsi:type="be.nabu.libs.services.vm.step.Link"
							disabled="false"
							id="1d22a088eb8b4fddb4cc7407e873af0d"
							mask="false"
							optional="false"
							fixedValue="false">
						<from>potentialStateRelations</from>
						<to>list</to>
					</steps>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="fd196921133c4ae7b7c16f085de04d23"
						mask="false"
						optional="false"
						fixedValue="false">
					<from>result25d1c29546fc4411a6e9f7701935d4e0/size</from>
					<to>amountOfPotentialStateRelations</to>
				</steps>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Throw"
					disabled="false"
					id="f1b74b7bd37d4ef8aa8426cefe45917f"
					label="amountOfPotentialStateRelations &gt;= 2"
					lineNumber="36"
					code="TOO-MANY-STATE-RELATIONS"
					whitelist="false" xsi:nil="true"/>
			<steps xsi:type="be.nabu.libs.services.vm.step.For"
					disabled="false"
					id="09325965497048109359ea241483c928"
					lineNumber="37"
					variable="potentialStateRelation">
				<steps xsi:type="be.nabu.libs.services.vm.step.Sequence"
						comment="Check condition"
						disabled="false"
						id="b7f35e7fd13e4a7da11219b9bb8256db"
						label="potentialStateRelation/condition != null"
						lineNumber="38">
					<steps xsi:type="be.nabu.libs.services.vm.step.Map"
							disabled="false"
							id="7fef764f953141c9b673f6e30d5ee32b"
							lineNumber="39">
						<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
								disabled="false"
								id="5cfe03d6446242a2937fde81a26ca3ae"
								serviceId="nabu.services.glue.Services.evaluate"
								resultName="result95599a59565f41bd8262be53ecb95561"
								temporaryMapping="true"
								x="196"
								y="196"
								invocationOrder="0"
								asynchronous="false"
								recache="false">
							<steps xsi:type="be.nabu.libs.services.vm.step.Link"
									disabled="false"
									id="59ddf204683c48de811864bd3296c89d"
									mask="false"
									optional="false"
									fixedValue="false">
								<from>instanceDataMap</from>
								<to>context[0]</to>
							</steps>
							<steps xsi:type="be.nabu.libs.services.vm.step.Link"
									disabled="false"
									id="b835412f156b4e90986b8808499fcdab"
									mask="false"
									optional="false"
									fixedValue="false">
								<from>potentialStateRelation/condition</from>
								<to>rule</to>
							</steps>
						</steps>
						<steps xsi:type="be.nabu.libs.services.vm.step.Link"
								disabled="false"
								id="5bf1eb1f9a92478aa2c24837d797ac49"
								mask="false"
								optional="false"
								fixedValue="false">
							<from>result95599a59565f41bd8262be53ecb95561/response</from>
							<to>conditionResult</to>
						</steps>
					</steps>
					<steps xsi:type="be.nabu.libs.services.vm.step.Map"
							disabled="false"
							id="e782be45b5174a228da7713df6305744"
							label="!conditionResult"
							lineNumber="40">
						<steps xsi:type="be.nabu.libs.services.vm.step.Link"
								disabled="false"
								id="d746f0c1172b482eb748410fccfe06fa"
								mask="false"
								optional="false"
								fixedValue="true">
							<from>false</from>
							<to>allowedToProceed</to>
						</steps>
					</steps>
				</steps>
				<query>potentialStateRelations</query>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Map"
					comment="If we have an initial line that is allowed, it doesn't matter what your incoming and outgoing flows say: you can run it!"
					disabled="true"
					id="ffdc3464d5c44ad48c96aff525a34d5f"
					label="amountOfPotentialStateRelations == 1 &amp;&amp; allowedToProceed"
					lineNumber="41">
				<steps xsi:type="be.nabu.libs.services.vm.step.Drop"
						disabled="false"
						id="030910e940ba43cea4702695f7bd4d51"
						path="incomingFlows" xsi:nil="true"/>
				<steps xsi:type="be.nabu.libs.services.vm.step.Drop"
						disabled="false"
						id="f0b7459a621c4ad1a1c3d179570bc899"
						path="outgoingFlows" xsi:nil="true"/>
				<steps xsi:type="be.nabu.libs.services.vm.step.Drop"
						disabled="false"
						id="d47ea376c6ee489b83ccbfe5bb53f1a3"
						path="potentialIncomingFlows" xsi:nil="true"/>
				<steps xsi:type="be.nabu.libs.services.vm.step.Drop"
						disabled="false"
						id="e3e81c7b007d4f2aae2a9c06da2cc42b"
						path="potentialOutgoingFlows" xsi:nil="true"/>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Map"
					comment="If we have an initial line that is allowed, it doesn't matter what your incoming and outgoing flows say: you can run it!"
					disabled="false"
					id="7f7d572085cb426d8c4921a711481426"
					label="amountOfPotentialStateRelations == 1 &amp;&amp; allowedToProceed"
					lineNumber="42">
				<steps xsi:type="be.nabu.libs.services.vm.step.Drop"
						disabled="false"
						id="51e3c466cc4643b2962ac80e7849dc66"
						path="incomingFlows" xsi:nil="true"/>
				<steps xsi:type="be.nabu.libs.services.vm.step.Drop"
						disabled="false"
						id="9bb2c4dfb8164ad69ca1dd9d3ee7fceb"
						path="potentialIncomingFlows" xsi:nil="true"/>
			</steps>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Sequence"
				comment="If we have incoming flow requirements, check that at least one is done"
				disabled="false"
				id="fb5c3769edcd42d187b1229fca0894c9"
				label="allowedToProceed &amp;&amp; incomingFlows != null"
				lineNumber="43">
			<steps xsi:type="be.nabu.libs.services.vm.step.For"
					disabled="false"
					id="a5c3905a9957498eb14a3a16d81c960d"
					lineNumber="44"
					variable="incomingFlow"
					into="runIncomingActions">
				<steps xsi:type="be.nabu.libs.services.vm.step.Map"
						comment="Get all run incoming flows. We intentionally include error here because we want to stop on that"
						disabled="false"
						id="96870e1120fd45c1b9a1d93866bec19e"
						lineNumber="45">
					<steps xsi:type="be.nabu.libs.services.vm.step.Link"
							disabled="false"
							id="eb022486ff4e4b698aa3fd81ad3823f1"
							mask="false"
							optional="false"
							fixedValue="false">
						<from>relatedActionInstances[processActionId == /incomingFlow/actionId &amp;&amp; ((/incomingFlow/relationType == "flow-failed" &amp;&amp; processState == "FAILED") || (/incomingFlow/relationType != "flow-failed" &amp;&amp; processState != "FAILED"))]</from>
						<to>runIncomingActions</to>
					</steps>
				</steps>
				<query>incomingFlows</query>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Throw"
					disabled="true"
					id="3ebc9fb93078418599cdec3ea4560931"
					label="&quot;ERROR&quot; # runIncomingActions/processState"
					lineNumber="46"
					message="Incoming flow step is currently in ERROR"
					whitelist="false" xsi:nil="true"/>
			<steps xsi:type="be.nabu.libs.services.vm.step.Switch"
					disabled="false"
					id="1c152ee78a464c3d9d53b894d8081441"
					lineNumber="47">
				<steps xsi:type="be.nabu.libs.services.vm.step.Map"
						comment="Incoming flow step is currently in ERROR, do not allow running of this action"
						disabled="false"
						id="675e0f0f563444d88b9f57a2e9054f4f"
						label="&quot;ERROR&quot; # runIncomingActions/processState"
						lineNumber="48">
					<steps xsi:type="be.nabu.libs.services.vm.step.Link"
							disabled="false"
							id="9a20982eef1f4ff395d31b4c8fabf966"
							fixedValue="true">
						<from>false</from>
						<to>allowedToProceed</to>
					</steps>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Map"
						comment="Set the allowed based on the existence of any incoming finished flows"
						disabled="false"
						id="311991d695d94112b43d0222e86bb939"
						lineNumber="49">
					<steps xsi:type="be.nabu.libs.services.vm.step.Link"
							disabled="false"
							id="3942523cbcf04c6a9bc5b8872f428930"
							mask="false"
							optional="false"
							fixedValue="true">
						<from>=runIncomingActions != null</from>
						<to>allowedToProceed</to>
					</steps>
					<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
							disabled="false"
							id="8563a818a6344088b869d9623f20d860"
							serviceId="nabu.frameworks.process.providers.action.service.utils.calculateActionRelationInstances"
							resultName="result6d6aceec01274add8fbbc03c3e1b78bd"
							temporaryMapping="true"
							x="21"
							y="50"
							invocationOrder="0"
							asynchronous="false"
							recache="false">
						<steps xsi:type="be.nabu.libs.services.vm.step.Link"
								disabled="false"
								id="164243bd50304626b234b828f55ffd25"
								mask="false"
								optional="false"
								fixedValue="false">
							<from>incomingFlows</from>
							<to>activatedRelations</to>
						</steps>
						<steps xsi:type="be.nabu.libs.services.vm.step.Link"
								disabled="false"
								id="71558f723b9b4b5ca9e4a9dc137ce50b"
								mask="false"
								optional="false"
								fixedValue="false">
							<from>runIncomingActions</from>
							<to>runIncomingActions</to>
						</steps>
					</steps>
					<steps xsi:type="be.nabu.libs.services.vm.step.Link"
							disabled="false"
							id="78aa8730d28c4e0db3d6fcd1ab198579"
							mask="false"
							optional="false"
							fixedValue="false">
						<from>result6d6aceec01274add8fbbc03c3e1b78bd/activatedRelations</from>
						<to>output/activatedRelations</to>
					</steps>
				</steps>
			</steps>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Map"
				comment="@2024-10-07: If we have no incoming flows but we do have potential incoming flows, they must all have evaluated to false. You are not allowed to proceed"
				disabled="false"
				id="8290c77af1cb49aab58fab57e1214133"
				label="allowedToProceed &amp;&amp; incomingFlows == null &amp;&amp; potentialIncomingFlows != null"
				lineNumber="50">
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="d401935e010049bb84daef9e674644c6"
					mask="false"
					optional="false"
					fixedValue="true">
				<from>false</from>
				<to>allowedToProceed</to>
			</steps>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Sequence"
				comment="If we have outgoing flow requirements, check that none are done. If we have no incoming flow requirements, we should always be able to run it (excepting maybe maxoccurs restrictions)"
				disabled="false"
				id="fda7117a3eb84734a73e0c8551b3efbc"
				label="allowedToProceed &amp;&amp; outgoingFlows != null"
				lineNumber="51">
			<steps xsi:type="be.nabu.libs.services.vm.step.For"
					disabled="false"
					id="f8980b0cfe794e91a81a66e2cf26ef5a"
					lineNumber="52"
					variable="outgoingFlow"
					into="finishedOutgoingActions">
				<steps xsi:type="be.nabu.libs.services.vm.step.Map"
						comment="Get all finished outgoing flows, check description!"
						disabled="false"
						id="6a4071ae36a74389be4337d144216ab0"
						lineNumber="53">
					<steps xsi:type="be.nabu.libs.services.vm.step.Link"
							disabled="false"
							id="65e805731dc04f7daf05c78bd65a1928"
							mask="false"
							optional="false"
							fixedValue="false">
						<from>relatedActionInstances[processActionId == /outgoingFlow/targetActionId &amp;&amp; processState != "FAILED"]</from>
						<to>finishedOutgoingActions</to>
					</steps>
				</steps>
				<query>outgoingFlows</query>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Map"
					comment="Set the allowed based on the existence of NO outgoing flows"
					disabled="false"
					id="78f11741d0a14ee79c9276449c055293"
					lineNumber="54">
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="6ea21b540f464fb3be3afd27aa3baac7"
						mask="false"
						optional="false"
						fixedValue="true">
					<from>=finishedOutgoingActions == null</from>
					<to>allowedToProceed</to>
				</steps>
			</steps>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Sequence"
				comment="Check that the action itself has not yet been executed OR that it has a maxoccurs that allows for it. Maxoccurs = 0 means infinite times. Max occurs ONLY takes into account succeeded runs!"
				disabled="false"
				id="06b8ea8304524479a80b64044bfaceb7"
				label="allowedToProceed &amp;&amp; potentialAction/maxOccurs != 0"
				lineNumber="55">
			<steps xsi:type="be.nabu.libs.services.vm.step.Map"
					comment="We ignore failed for this count"
					disabled="false"
					id="ba00e6cb7e6e46d9ae7e1c626d76a190"
					lineNumber="56">
				<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
						disabled="false"
						id="cf7999ab1a8d4781bafd97188079f6ee"
						serviceId="nabu.utils.List.size"
						resultName="resulted0c77eec28a418eac5af898c978faee"
						temporaryMapping="true"
						x="151"
						y="127"
						invocationOrder="0"
						asynchronous="false"
						recache="false">
					<steps xsi:type="be.nabu.libs.services.vm.step.Link"
							disabled="false"
							id="5224b55150674af5b134097ed179231a"
							mask="false"
							optional="false"
							fixedValue="false">
						<from>relatedActionInstances[processActionId == /potentialAction/id &amp;&amp; processState != "FAILED"]</from>
						<to>list</to>
					</steps>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="a02cf93b401e416aaee7ac6cafe4da3c"
						mask="false"
						optional="false"
						fixedValue="false">
					<from>resulted0c77eec28a418eac5af898c978faee/size</from>
					<to>amountOfTimesRun</to>
				</steps>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Map"
					comment="Set the allowed to proceed based on the count"
					disabled="false"
					id="1d3b394314cc49a788b9e9e4f64b50d6"
					lineNumber="57">
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="891a21fc1f89456aab90129fe3613cc8"
						mask="false"
						optional="false"
						fixedValue="true">
					<from>=potentialAction/maxOccurs == 0 || amountOfTimesRun &lt; potentialAction/maxOccurs</from>
					<to>allowedToProceed</to>
				</steps>
			</steps>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Map"
				comment="Set output"
				disabled="false"
				id="86521b1bc8a34626954144810d36b257"
				label="allowedToProceed"
				lineNumber="58">
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="2bb16461806a45ff8e6d2efd5e94ae09"
					mask="false"
					optional="false"
					fixedValue="true">
				<from>true</from>
				<to>output/allowedToProceed</to>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="a50f1466debc4e929a21cdf28acd89ea"
					mask="false"
					optional="false"
					fixedValue="true">
				<from>="RUNNING" # /runIncomingActions/processState</from>
				<to>output/nested</to>
			</steps>
		</steps>
	</steps>
</sequence>