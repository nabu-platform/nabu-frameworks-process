<sequence xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
		disabled="false"
		id="e3256420fe6f4426ad33b2eb9cdb039a"
		lineNumber="1">
	<steps xsi:type="be.nabu.libs.services.vm.step.Map"
			disabled="false"
			id="73420df86cfe4bc590ee9d90ba072923"
			lineNumber="2">
		<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
				disabled="false"
				id="0c94674d706b41288c8fd90fb1d70165"
				serviceId="nabu.frameworks.process.providers.action.service.utils.getProcessDefinition"
				resultName="result0d24545034d34c46a551592eace1c7b9"
				temporaryMapping="true"
				x="125"
				y="147"
				invocationOrder="1"
				asynchronous="false"
				recache="false">
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="ca3a7b81c29b431e871b375247fa31bc"
					mask="false"
					optional="false"
					fixedValue="false">
				<from>input/processVersionId</from>
				<to>processVersionId</to>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="7e7aac704c5b48f4852cb9838c780541"
					mask="false"
					optional="false"
					fixedValue="false">
				<from>input/connectionId</from>
				<to>connectionId</to>
			</steps>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Link"
				disabled="false"
				id="43515498cae84cb7bb857a003a25370f"
				mask="false"
				optional="false"
				fixedValue="false">
			<from>result0d24545034d34c46a551592eace1c7b9/definition/states[id == /input/stateInstance/processStateId]</from>
			<to>state</to>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Link"
				disabled="false"
				id="535d62a535fb4d5cb2bfacda5d1e1c48"
				mask="false"
				optional="false"
				fixedValue="false">
			<from>result0d24545034d34c46a551592eace1c7b9/definition</from>
			<to>definition</to>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Link"
				disabled="false"
				id="d7df7a88449b433097a95b133726b709"
				mask="false"
				optional="false"
				fixedValue="false">
			<from>result0d24545034d34c46a551592eace1c7b9/definition/states[id == /input/stateInstance/processStateId]/actions[actionType == "finalizer"]</from>
			<to>finalizers</to>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Link"
				disabled="false"
				id="222de23a22c7415aa2acd0759b2c0a08"
				mask="false"
				optional="false"
				fixedValue="true">
			<from>false</from>
			<to>output/finalized</to>
		</steps>
	</steps>
	<steps xsi:type="be.nabu.libs.services.vm.step.Map"
			comment="Get automated actions"
			disabled="false"
			id="0ebbe353bffc4de998687803b31566f1"
			label="state"
			lineNumber="3">
		<steps xsi:type="be.nabu.libs.services.vm.step.Link"
				disabled="false"
				id="6d723669e88d4a3f8b162407dfd1ecbf"
				mask="false"
				optional="false"
				fixedValue="false">
			<from>state/actions[automatic == true]</from>
			<to>automaticActions</to>
		</steps>
	</steps>
	<steps xsi:type="be.nabu.libs.services.vm.step.Sequence"
			comment="Need to check if they have incoming flow requirements"
			disabled="false"
			id="5211bc19f8bf477db9cfe3c962203866"
			label="automaticActions"
			lineNumber="4">
		<steps xsi:type="be.nabu.libs.services.vm.step.Map"
				comment="Get a list of the ids"
				disabled="false"
				id="3021bf502f6640debfd082f823de7e44"
				lineNumber="5">
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="efd57bcd74dd416d894e6e7793236b43"
					mask="false"
					optional="false"
					fixedValue="false">
				<from>automaticActions/id</from>
				<to>automaticActionIds</to>
			</steps>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Map"
				comment="Get all flow relations pertaining to those"
				disabled="false"
				id="be0ab7ebc01a4583b3ed288a13d2c277"
				lineNumber="6">
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="9ef27e59bc86476a9cc120982089d96d"
					mask="false"
					optional="false"
					fixedValue="false">
				<from>definition/actionRelations[targetActionId # /automaticActionIds &amp;&amp; relationType == "flow"]</from>
				<to>flowRelations</to>
			</steps>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Map"
				comment="Get a list of _those_ ids"
				disabled="false"
				id="c438118bf6174b86b42e2d588e0a7c0a"
				lineNumber="7">
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="7e3cf6d6ec144951bd004dd2d8816668"
					mask="false"
					optional="false"
					fixedValue="false">
				<from>flowRelations/targetActionId</from>
				<to>actionsWithRequirementIds</to>
			</steps>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Map"
				comment="Retain only automatic actions that are not in the new list"
				disabled="false"
				id="71b839ff01244f2885cc401fc7e9cfd1"
				lineNumber="8">
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="a4763fdf3f724b808ccbf587ff47948b"
					mask="false"
					optional="false"
					fixedValue="false">
				<from>automaticActions[id !# /actionsWithRequirementIds]</from>
				<to>automaticActions</to>
			</steps>
		</steps>
	</steps>
	<steps xsi:type="be.nabu.libs.services.vm.step.For"
			disabled="false"
			id="42c08776d0ad4e5e9befc8f401b10e82"
			lineNumber="9"
			variable="automaticAction">
		<steps xsi:type="be.nabu.libs.services.vm.step.Map"
				disabled="false"
				id="254f6cf149fb47b4981d7b1bf79eaea9"
				lineNumber="10">
			<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
					disabled="false"
					id="13ae8989fd3c4550acb6ee97a0a8fa63"
					serviceId="nabu.frameworks.process.providers.action.service.utils.tracker.runAction"
					resultName="resulta867203194c7446383877ff23aeb92be"
					temporaryMapping="true"
					x="149"
					y="74"
					invocationOrder="0"
					asynchronous="false"
					recache="false">
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="1b990cba47944b209589d7aa52e04ed0"
						mask="false"
						optional="false"
						fixedValue="false">
					<from>input/stateInstance/processInstanceId</from>
					<to>processInstanceId</to>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="86831fac07c24648bab892995b500b3d"
						mask="false"
						optional="false"
						fixedValue="false">
					<from>input/stateInstance/id</from>
					<to>processStateInstanceId</to>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="80314769e90647e499fb25024618f249"
						mask="false"
						optional="false"
						fixedValue="false">
					<from>automaticAction/id</from>
					<to>actionId</to>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="a6ed9ca036de425cb5870dabb1afec2b"
						mask="false"
						optional="false"
						fixedValue="false">
					<from>input/processData</from>
					<to>processData</to>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="a1ce5321f13e482dbe555fd8a95595d9"
						mask="false"
						optional="false"
						fixedValue="false">
					<from>input/processVersionId</from>
					<to>processVersionId</to>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="6c6f681341fe47b7af1561c58dd99bb1"
						mask="false"
						optional="false"
						fixedValue="false">
					<from>input/transactionId</from>
					<to>transactionId</to>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="4fba6355d99249e392ab0c768e58e81b"
						mask="false"
						optional="false"
						fixedValue="false">
					<from>input/connectionId</from>
					<to>connectionId</to>
				</steps>
			</steps>
		</steps>
		<query>automaticActions</query>
	</steps>
	<steps xsi:type="be.nabu.libs.services.vm.step.For"
			comment="Check if we have a finalizer at the root of a state"
			disabled="false"
			id="01bf2830f69742f0a977a63d00b20b47"
			lineNumber="11"
			variable="finalizer">
		<steps xsi:type="be.nabu.libs.services.vm.step.Map"
				disabled="false"
				id="939408e0c6df44fa924a0df801afd44c"
				lineNumber="12">
			<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
					disabled="false"
					id="ef629caab91d49d6920b72c852d4bc25"
					serviceId="nabu.utils.List.size"
					resultName="resultd10270bb599b42b298a38f03a46e5617"
					temporaryMapping="true"
					x="195"
					y="169"
					invocationOrder="0"
					asynchronous="false"
					recache="false">
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="a24210e3c85d400a9fa6d650b32dbff6"
						mask="false"
						optional="false"
						fixedValue="false">
					<from>definition/actionRelations[targetActionId == /finalizer/id &amp;&amp; relationType == "flow"]</from>
					<to>list</to>
				</steps>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="98eedadff2134aefbfbd7539412381b6"
					mask="false"
					optional="false"
					fixedValue="false">
				<from>resultd10270bb599b42b298a38f03a46e5617/size</from>
				<to>amountOfIncomingFlows</to>
			</steps>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Sequence"
				disabled="false"
				id="6712cc6cc01d4e8996137744f411377d"
				label="amountOfIncomingFlows == 0"
				lineNumber="13">
			<steps xsi:type="be.nabu.libs.services.vm.step.Map"
					comment="If we get here, we want to stop the process"
					disabled="false"
					id="47351a91913d4ec184ff4497a57fba3e"
					lineNumber="14">
				<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
						disabled="false"
						id="4937cc7a3abc423eaf85c2e7c2c1d1a0"
						serviceId="nabu.frameworks.process.providers.action.service.utils.tracker.finalizeState"
						resultName="resultda1d2075e19347578874afd0397f2812"
						temporaryMapping="true"
						x="428"
						y="156"
						invocationOrder="1"
						asynchronous="false"
						recache="false">
					<steps xsi:type="be.nabu.libs.services.vm.step.Link"
							disabled="false"
							id="8becef7475d04bc29054caabd5539971"
							mask="false"
							optional="false"
							fixedValue="false">
						<from>resultab07355d2a834045b34f574cb15c6824/date</from>
						<to>parameters[0]/now</to>
					</steps>
					<steps xsi:type="be.nabu.libs.services.vm.step.Link"
							disabled="false"
							id="178874000c684c609d5f1ce478d4120f"
							mask="false"
							optional="false"
							fixedValue="false">
						<from>input/stateInstance/id</from>
						<to>parameters[0]/processStateInstanceId</to>
					</steps>
					<steps xsi:type="be.nabu.libs.services.vm.step.Link"
							disabled="false"
							id="21a312b5a6d24a9aaba1f86be6f8d40b"
							mask="false"
							optional="false"
							fixedValue="false">
						<from>input/connectionId</from>
						<to>connection</to>
					</steps>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
						disabled="false"
						id="359eaa38b19447428f883dd6bfd56668"
						serviceId="nabu.frameworks.process.providers.action.service.utils.tracker.finalizeProcess"
						resultName="resultd2e12b7e011e412dbb532c0700eac020"
						temporaryMapping="true"
						x="515"
						y="37"
						invocationOrder="1"
						asynchronous="false"
						recache="false">
					<steps xsi:type="be.nabu.libs.services.vm.step.Link"
							disabled="false"
							id="e5ee98d75e6b4706b3183339d201738c"
							mask="false"
							optional="false"
							fixedValue="false">
						<from>resultab07355d2a834045b34f574cb15c6824/date</from>
						<to>parameters[0]/now</to>
					</steps>
					<steps xsi:type="be.nabu.libs.services.vm.step.Link"
							disabled="false"
							id="a92b127f0a4e4b808e9fa380ed157bf1"
							mask="false"
							optional="false"
							fixedValue="false">
						<from>input/stateInstance/processInstanceId</from>
						<to>parameters[0]/processInstanceId</to>
					</steps>
					<steps xsi:type="be.nabu.libs.services.vm.step.Link"
							disabled="false"
							id="d9061bface394beeb74a06ce8fd097c9"
							mask="false"
							optional="false"
							fixedValue="false">
						<from>input/connectionId</from>
						<to>connection</to>
					</steps>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
						disabled="false"
						id="c0ed8094a3e34877a753aa5246e48ff1"
						serviceId="nabu.utils.Date.now"
						resultName="resultab07355d2a834045b34f574cb15c6824"
						temporaryMapping="true"
						x="20"
						y="163"
						invocationOrder="0"
						asynchronous="false"
						recache="false">
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="e5586f141ff84360b2a23c70b6ec59c4"
						mask="false"
						optional="false"
						fixedValue="true">
					<from>true</from>
					<to>output/finalized</to>
				</steps>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Break"
					disabled="false"
					id="e47e26c9ce454fc78534fd4013798e83"
					lineNumber="15">
				<count>2</count>
			</steps>
		</steps>
		<query>finalizers</query>
	</steps>
</sequence>