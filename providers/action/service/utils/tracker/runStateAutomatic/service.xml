<sequence xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
		disabled="false"
		id="e3256420fe6f4426ad33b2eb9cdb039a"
		lineNumber="1">
	<steps xsi:type="be.nabu.libs.services.vm.step.Map"
			disabled="false"
			id="73420df86cfe4bc590ee9d90ba072923"
			lineNumber="2">
		<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
				disabled="false"
				id="0c94674d706b41288c8fd90fb1d70165"
				serviceId="nabu.frameworks.process.providers.action.service.utils.getProcessDefinition"
				resultName="result0d24545034d34c46a551592eace1c7b9"
				temporaryMapping="true"
				x="125"
				y="147"
				invocationOrder="1"
				asynchronous="false"
				recache="false">
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="ca3a7b81c29b431e871b375247fa31bc"
					mask="false"
					optional="false"
					fixedValue="false">
				<from>input/processVersionId</from>
				<to>processVersionId</to>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="7e7aac704c5b48f4852cb9838c780541"
					mask="false"
					optional="false"
					fixedValue="false">
				<from>input/connectionId</from>
				<to>connectionId</to>
			</steps>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Link"
				disabled="false"
				id="43515498cae84cb7bb857a003a25370f"
				mask="false"
				optional="false"
				fixedValue="false">
			<from>result0d24545034d34c46a551592eace1c7b9/definition/states[id == /input/stateInstance/processStateId]</from>
			<to>state</to>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Link"
				disabled="false"
				id="535d62a535fb4d5cb2bfacda5d1e1c48"
				mask="false"
				optional="false"
				fixedValue="false">
			<from>result0d24545034d34c46a551592eace1c7b9/definition</from>
			<to>definition</to>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Link"
				disabled="false"
				id="d7df7a88449b433097a95b133726b709"
				mask="false"
				optional="false"
				fixedValue="false">
			<from>result0d24545034d34c46a551592eace1c7b9/definition/states[id == /input/stateInstance/processStateId]/actions[actionType == "finalizer"]</from>
			<to>finalizers</to>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Link"
				disabled="false"
				id="222de23a22c7415aa2acd0759b2c0a08"
				mask="false"
				optional="false"
				fixedValue="true">
			<from>false</from>
			<to>output/finalized</to>
		</steps>
	</steps>
	<steps xsi:type="be.nabu.libs.services.vm.step.Map"
			comment="Get list of ids"
			disabled="false"
			id="d6302c7b5026406c8e4d0a7569eb192a"
			label="finalizers"
			lineNumber="3">
		<steps xsi:type="be.nabu.libs.services.vm.step.Link"
				disabled="false"
				id="1d1033d8b29441a79c2f7f98b8639163"
				mask="false"
				optional="false"
				fixedValue="false">
			<from>finalizers/id</from>
			<to>finalizerIds</to>
		</steps>
	</steps>
	<steps xsi:type="be.nabu.libs.services.vm.step.Map"
			comment="Get automated actions"
			disabled="false"
			id="0ebbe353bffc4de998687803b31566f1"
			label="state"
			lineNumber="4">
		<steps xsi:type="be.nabu.libs.services.vm.step.Link"
				disabled="false"
				id="6d723669e88d4a3f8b162407dfd1ecbf"
				mask="false"
				optional="false"
				fixedValue="false">
			<from>state/actions[automatic == true]</from>
			<to>automaticActions</to>
		</steps>
	</steps>
	<steps xsi:type="be.nabu.libs.services.vm.step.Sequence"
			comment="Need to check if they have incoming flow requirements"
			disabled="false"
			id="5211bc19f8bf477db9cfe3c962203866"
			label="automaticActions"
			lineNumber="5">
		<steps xsi:type="be.nabu.libs.services.vm.step.Map"
				comment="Get a list of the ids"
				disabled="false"
				id="3021bf502f6640debfd082f823de7e44"
				lineNumber="6">
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="efd57bcd74dd416d894e6e7793236b43"
					mask="false"
					optional="false"
					fixedValue="false">
				<from>automaticActions/id</from>
				<to>automaticActionIds</to>
			</steps>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Map"
				comment="Get all flow relations pertaining to those"
				disabled="false"
				id="be0ab7ebc01a4583b3ed288a13d2c277"
				lineNumber="7">
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="9ef27e59bc86476a9cc120982089d96d"
					mask="false"
					optional="false"
					fixedValue="false">
				<from>definition/actionRelations[targetActionId # /automaticActionIds &amp;&amp; (relationType == "flow" || relationType == "flow-start")]</from>
				<to>flowRelations</to>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="75b85ef49739472cb15f91a522653c82"
					mask="false"
					optional="false"
					fixedValue="false">
				<from>definition/stateRelations[(actionId # /automaticActionIds || actionId # /finalizerIds) &amp;&amp; relationType == "flow-initial"]</from>
				<to>flowInitialRelations</to>
			</steps>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Map"
				comment="Get a list of _those_ ids"
				disabled="false"
				id="c438118bf6174b86b42e2d588e0a7c0a"
				lineNumber="8">
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="7e3cf6d6ec144951bd004dd2d8816668"
					mask="false"
					optional="false"
					fixedValue="false">
				<from>flowRelations/targetActionId</from>
				<to>actionsWithRequirementIds</to>
			</steps>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Map"
				comment="Retain only automatic actions that are not in the new list"
				disabled="false"
				id="71b839ff01244f2885cc401fc7e9cfd1"
				lineNumber="9">
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="a4763fdf3f724b808ccbf587ff47948b"
					mask="false"
					optional="false"
					fixedValue="false">
				<from>automaticActions[id !# /actionsWithRequirementIds]</from>
				<to>automaticActions</to>
			</steps>
		</steps>
	</steps>
	<steps xsi:type="be.nabu.libs.services.vm.step.Map"
			comment="If we have any conditions, create a map"
			disabled="false"
			id="86993ec5f5454b80bf9e39575181321b"
			label="flowInitialRelations != null &amp;&amp; input/processData != null"
			lineNumber="10">
		<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
				disabled="false"
				id="029874d4017f4b78bda2018d68bb27e0"
				serviceId="nabu.utils.List.toMap"
				resultName="resulteffac0dc821b4630a5c02f541faea07a"
				temporaryMapping="true"
				x="36"
				y="105"
				invocationOrder="0"
				asynchronous="false"
				recache="false">
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="48bf0b1f887f499f95705a7a5a83bbe9"
					mask="false"
					optional="false"
					fixedValue="false">
				<from>input/processData</from>
				<to>list</to>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="b6886af125bc4c308234f6cfbe16e165"
					mask="false"
					optional="false"
					fixedValue="true">
				<from>name</from>
				<to>keyField</to>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="206ff05c7c6c423380c74358ae8881aa"
					mask="false"
					optional="false"
					fixedValue="true">
				<from>value</from>
				<to>valueField</to>
			</steps>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Link"
				disabled="false"
				id="c06648760a584606a2dfe0e4244ddaab"
				mask="false"
				optional="false"
				fixedValue="false">
			<from>resulteffac0dc821b4630a5c02f541faea07a/map</from>
			<to>map</to>
		</steps>
	</steps>
	<steps xsi:type="be.nabu.libs.services.vm.step.For"
			disabled="false"
			id="42c08776d0ad4e5e9befc8f401b10e82"
			lineNumber="11"
			variable="automaticAction">
		<steps xsi:type="be.nabu.libs.services.vm.step.Map"
				comment="Get the initial flow relation"
				disabled="false"
				id="78f861437efd4985ad8f705c516d8f0d"
				lineNumber="12">
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="28ba7891688d4bc89735fab5c3bc0b39"
					mask="false"
					optional="false"
					fixedValue="false">
				<from>flowInitialRelations[actionId == /automaticAction/id]</from>
				<to>flowInitialRelation</to>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
					disabled="false"
					id="95f49ca3f5354ee29e0fdff768f89dea"
					serviceId="nabu.utils.List.size"
					resultName="result87bea245f5b6431fa6a9da774784b870"
					temporaryMapping="true"
					x="222"
					y="138"
					invocationOrder="0"
					asynchronous="false"
					recache="false">
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="ddc2c4e197b2442fa3252d55dfa6260a"
						mask="false"
						optional="false"
						fixedValue="false">
					<from>flowRelations[targetActionId == /finalizer/id &amp;&amp; (relationType == "flow" || relationType == "flow-start")]</from>
					<to>list</to>
				</steps>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="3b17a9f139d0458c98a931c47d48f61a"
					mask="false"
					optional="false"
					fixedValue="false">
				<from>result87bea245f5b6431fa6a9da774784b870/size</from>
				<to>amountOfIncomingFlows</to>
			</steps>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Throw"
				disabled="false"
				features="PROCESS_STATE_REQUIRE_INITIAL_FLOW"
				id="fedd9fa5e6e24dff86ebd69d3feb2ebf"
				label="!flowInitialRelation"
				lineNumber="13"
				message="An automatic action has no incoming action relations nor an incoming state relation"
				whitelist="false" xsi:nil="true"/>
		<steps xsi:type="be.nabu.libs.services.vm.step.Sequence"
				disabled="false"
				id="6db223b4ef46483bb400b1ee8d4503f3"
				label="flowInitialRelation/condition != null"
				lineNumber="14">
			<steps xsi:type="be.nabu.libs.services.vm.step.Map"
					disabled="false"
					id="0b2401150317482db5cb4d4398e13a2d"
					lineNumber="15">
				<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
						disabled="false"
						id="b50f2ccdb38444ac977d27355dc20c57"
						serviceId="nabu.services.glue.Services.evaluate"
						resultName="result8f4403c86bb6450c931065e771bcdbbf"
						temporaryMapping="true"
						x="57"
						y="77"
						invocationOrder="0"
						asynchronous="false"
						recache="false">
					<steps xsi:type="be.nabu.libs.services.vm.step.Link"
							disabled="false"
							id="64eed07992e347698e76aef54a9e6826"
							mask="false"
							optional="false"
							fixedValue="false">
						<from>map</from>
						<to>context[0]</to>
					</steps>
					<steps xsi:type="be.nabu.libs.services.vm.step.Link"
							disabled="false"
							id="0aa5f0f48f3d448ea64a6f31ddd9923e"
							mask="false"
							optional="false"
							fixedValue="false">
						<from>flowInitialRelation/condition</from>
						<to>rule</to>
					</steps>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="6d1670ff15264b8ea66fe5c21eb24a97"
						mask="false"
						optional="false"
						fixedValue="false">
					<from>result8f4403c86bb6450c931065e771bcdbbf/response</from>
					<to>result</to>
				</steps>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Break"
					disabled="false"
					id="92d066f1688d4b4ebe9a92f464e302ae"
					label="result != true"
					lineNumber="16">
				<count>2</count>
				<continueExecution>true</continueExecution>
			</steps>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Map"
				disabled="false"
				id="254f6cf149fb47b4981d7b1bf79eaea9"
				label="amountOfIncomingFlows == 0"
				lineNumber="17">
			<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
					disabled="false"
					id="13ae8989fd3c4550acb6ee97a0a8fa63"
					serviceId="nabu.frameworks.process.providers.action.service.utils.tracker.runAction"
					resultName="resulta867203194c7446383877ff23aeb92be"
					temporaryMapping="true"
					x="149"
					y="74"
					invocationOrder="0"
					asynchronous="false"
					recache="false">
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="1b990cba47944b209589d7aa52e04ed0"
						mask="false"
						optional="false"
						fixedValue="false">
					<from>input/stateInstance/processInstanceId</from>
					<to>processInstanceId</to>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="86831fac07c24648bab892995b500b3d"
						mask="false"
						optional="false"
						fixedValue="false">
					<from>input/stateInstance/id</from>
					<to>processStateInstanceId</to>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="80314769e90647e499fb25024618f249"
						mask="false"
						optional="false"
						fixedValue="false">
					<from>automaticAction/id</from>
					<to>actionId</to>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="a6ed9ca036de425cb5870dabb1afec2b"
						mask="false"
						optional="false"
						fixedValue="false">
					<from>input/processData</from>
					<to>processData</to>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="a1ce5321f13e482dbe555fd8a95595d9"
						mask="false"
						optional="false"
						fixedValue="false">
					<from>input/processVersionId</from>
					<to>processVersionId</to>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="6c6f681341fe47b7af1561c58dd99bb1"
						mask="false"
						optional="false"
						fixedValue="false">
					<from>input/transactionId</from>
					<to>transactionId</to>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="4fba6355d99249e392ab0c768e58e81b"
						mask="false"
						optional="false"
						fixedValue="false">
					<from>input/connectionId</from>
					<to>connectionId</to>
				</steps>
			</steps>
		</steps>
		<query>automaticActions</query>
	</steps>
	<steps xsi:type="be.nabu.libs.services.vm.step.For"
			comment="Check if we have a finalizer at the root of a state"
			disabled="false"
			id="01bf2830f69742f0a977a63d00b20b47"
			lineNumber="18"
			variable="finalizer">
		<steps xsi:type="be.nabu.libs.services.vm.step.Map"
				disabled="false"
				id="939408e0c6df44fa924a0df801afd44c"
				lineNumber="19">
			<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
					disabled="false"
					id="ef629caab91d49d6920b72c852d4bc25"
					serviceId="nabu.utils.List.size"
					resultName="resultd10270bb599b42b298a38f03a46e5617"
					temporaryMapping="true"
					x="195"
					y="169"
					invocationOrder="0"
					asynchronous="false"
					recache="false">
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="a24210e3c85d400a9fa6d650b32dbff6"
						mask="false"
						optional="false"
						fixedValue="false">
					<from>definition/actionRelations[targetActionId == /finalizer/id &amp;&amp; relationType == "flow"]</from>
					<to>list</to>
				</steps>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="98eedadff2134aefbfbd7539412381b6"
					mask="false"
					optional="false"
					fixedValue="false">
				<from>resultd10270bb599b42b298a38f03a46e5617/size</from>
				<to>amountOfIncomingFlows</to>
			</steps>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Map"
				comment="Get the initial flow relation"
				disabled="false"
				id="172279aacb144e359e1f12e75cb1e619"
				lineNumber="20">
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="e3c28af82b8f4478845509811df123fa"
					mask="false"
					optional="false"
					fixedValue="false">
				<from>flowInitialRelations[actionId == /finalizer/id]</from>
				<to>flowInitialRelation</to>
			</steps>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Throw"
				disabled="false"
				features="PROCESS_STATE_REQUIRE_INITIAL_FLOW"
				id="dbf62357806f4acc99c43ee4b82bbe88"
				label="!flowInitialRelation"
				lineNumber="21"
				message="An automatic action has no incoming action relations nor an incoming state relation"
				whitelist="false" xsi:nil="true"/>
		<steps xsi:type="be.nabu.libs.services.vm.step.Sequence"
				disabled="false"
				id="1eb2a70a45604318bd845caac6c703cf"
				label="flowInitialRelation/condition != null"
				lineNumber="22">
			<steps xsi:type="be.nabu.libs.services.vm.step.Map"
					disabled="false"
					id="26ced3a64e474be085555407e1789542"
					lineNumber="23">
				<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
						disabled="false"
						id="912684a1e7704bb5912716d78535fbc1"
						serviceId="nabu.services.glue.Services.evaluate"
						resultName="result8f4403c86bb6450c931065e771bcdbbf"
						temporaryMapping="true"
						x="57"
						y="77"
						invocationOrder="0"
						asynchronous="false"
						recache="false">
					<steps xsi:type="be.nabu.libs.services.vm.step.Link"
							disabled="false"
							id="b8592eec19314c11bf0c60427ce6373b"
							mask="false"
							optional="false"
							fixedValue="false">
						<from>map</from>
						<to>context[0]</to>
					</steps>
					<steps xsi:type="be.nabu.libs.services.vm.step.Link"
							disabled="false"
							id="91ca6a869f1e48e1b3af1c80f85825e6"
							mask="false"
							optional="false"
							fixedValue="false">
						<from>flowInitialRelation/condition</from>
						<to>rule</to>
					</steps>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="49dbf8abe699497d8c9bcdb4be873e2f"
						mask="false"
						optional="false"
						fixedValue="false">
					<from>result8f4403c86bb6450c931065e771bcdbbf/response</from>
					<to>result</to>
				</steps>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Break"
					disabled="false"
					id="55486524fcd5494781483760b95b6a5b"
					label="result != true"
					lineNumber="24">
				<count>2</count>
				<continueExecution>true</continueExecution>
			</steps>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Sequence"
				disabled="false"
				id="6712cc6cc01d4e8996137744f411377d"
				label="amountOfIncomingFlows == 0"
				lineNumber="25">
			<steps xsi:type="be.nabu.libs.services.vm.step.Map"
					comment="If we get here, we want to stop the process"
					disabled="false"
					id="47351a91913d4ec184ff4497a57fba3e"
					lineNumber="26">
				<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
						disabled="false"
						id="4937cc7a3abc423eaf85c2e7c2c1d1a0"
						serviceId="nabu.frameworks.process.providers.action.service.utils.tracker.finalizeState"
						resultName="resultda1d2075e19347578874afd0397f2812"
						temporaryMapping="true"
						x="428"
						y="156"
						invocationOrder="1"
						asynchronous="false"
						recache="false">
					<steps xsi:type="be.nabu.libs.services.vm.step.Link"
							disabled="false"
							id="8becef7475d04bc29054caabd5539971"
							mask="false"
							optional="false"
							fixedValue="false">
						<from>resultab07355d2a834045b34f574cb15c6824/date</from>
						<to>parameters[0]/now</to>
					</steps>
					<steps xsi:type="be.nabu.libs.services.vm.step.Link"
							disabled="false"
							id="178874000c684c609d5f1ce478d4120f"
							mask="false"
							optional="false"
							fixedValue="false">
						<from>input/stateInstance/id</from>
						<to>parameters[0]/processStateInstanceId</to>
					</steps>
					<steps xsi:type="be.nabu.libs.services.vm.step.Link"
							disabled="false"
							id="21a312b5a6d24a9aaba1f86be6f8d40b"
							mask="false"
							optional="false"
							fixedValue="false">
						<from>input/connectionId</from>
						<to>connection</to>
					</steps>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
						disabled="false"
						id="359eaa38b19447428f883dd6bfd56668"
						serviceId="nabu.frameworks.process.providers.action.service.utils.tracker.finalizeProcess"
						resultName="resultd2e12b7e011e412dbb532c0700eac020"
						temporaryMapping="true"
						x="515"
						y="37"
						invocationOrder="1"
						asynchronous="false"
						recache="false">
					<steps xsi:type="be.nabu.libs.services.vm.step.Link"
							disabled="false"
							id="e5ee98d75e6b4706b3183339d201738c"
							mask="false"
							optional="false"
							fixedValue="false">
						<from>resultab07355d2a834045b34f574cb15c6824/date</from>
						<to>parameters[0]/now</to>
					</steps>
					<steps xsi:type="be.nabu.libs.services.vm.step.Link"
							disabled="false"
							id="a92b127f0a4e4b808e9fa380ed157bf1"
							mask="false"
							optional="false"
							fixedValue="false">
						<from>input/stateInstance/processInstanceId</from>
						<to>parameters[0]/processInstanceId</to>
					</steps>
					<steps xsi:type="be.nabu.libs.services.vm.step.Link"
							disabled="false"
							id="d9061bface394beeb74a06ce8fd097c9"
							mask="false"
							optional="false"
							fixedValue="false">
						<from>input/connectionId</from>
						<to>connection</to>
					</steps>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
						disabled="false"
						id="c0ed8094a3e34877a753aa5246e48ff1"
						serviceId="nabu.utils.Date.now"
						resultName="resultab07355d2a834045b34f574cb15c6824"
						temporaryMapping="true"
						x="20"
						y="163"
						invocationOrder="0"
						asynchronous="false"
						recache="false">
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="e5586f141ff84360b2a23c70b6ec59c4"
						mask="false"
						optional="false"
						fixedValue="true">
					<from>true</from>
					<to>output/finalized</to>
				</steps>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Break"
					disabled="false"
					id="e47e26c9ce454fc78534fd4013798e83"
					lineNumber="27">
				<count>2</count>
			</steps>
		</steps>
		<query>finalizers</query>
	</steps>
</sequence>