<sequence xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
		disabled="false"
		id="d707fe49ddd143409920eddb43ec6544"
		lineNumber="1">
	<steps xsi:type="be.nabu.libs.services.vm.step.Switch"
			disabled="false"
			id="d1bf471698e04fc6843c79a8b909555d"
			lineNumber="2">
		<steps xsi:type="be.nabu.libs.services.vm.step.Map"
				disabled="false"
				id="c54e358aabdf402e938713e7914df4cc"
				label="input/serviceId != null"
				lineNumber="3">
			<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
					disabled="false"
					id="bbf06081c8c94b62aec45b1d7ae7e86f"
					serviceId="nabu.frameworks.process.providers.action.service.utils.getPotentialServiceActions"
					resultName="result78a7c5501506441aa923e2e586323d94"
					temporaryMapping="true"
					x="108"
					y="36"
					invocationOrder="0"
					asynchronous="false"
					recache="false">
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="932c79d65a0747e98528c83f61c89c9c"
						mask="false"
						optional="false"
						fixedValue="false">
					<from>input/serviceId</from>
					<to>serviceId</to>
				</steps>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="47ab260bf76e4634b660dd08ef77665b"
					mask="false"
					optional="false"
					fixedValue="false">
				<from>result78a7c5501506441aa923e2e586323d94/actions</from>
				<to>output/actionsToRun</to>
			</steps>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Throw"
				disabled="false"
				id="b6ce3e3697704d8ca5117f86adc819be"
				lineNumber="4"
				message="Can't get potential actions" xsi:nil="true"/>
	</steps>
	<steps xsi:type="be.nabu.libs.services.vm.step.Map"
			disabled="false"
			id="1feb34f48946476ebd014770222064f2"
			label="input/correlationId == null"
			lineNumber="5">
		<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
				disabled="false"
				id="260a2006a6c14711b68f33d3107c980a"
				serviceId="nabu.utils.Runtime.getCorrelationId"
				resultName="resultfa023529e967449f85b33e578ba3d4aa"
				temporaryMapping="true"
				x="78"
				y="69"
				invocationOrder="0"
				asynchronous="false"
				recache="false">
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Link"
				disabled="false"
				id="2e1c23fec079419e929a08814bae4f1c"
				mask="false"
				optional="false"
				fixedValue="false">
			<from>resultfa023529e967449f85b33e578ba3d4aa/correlationId</from>
			<to>input/correlationId</to>
		</steps>
	</steps>
	<steps xsi:type="be.nabu.libs.services.vm.step.Map"
			disabled="false"
			id="391b7bb837ed436aaebf467ed737f87e"
			lineNumber="6">
		<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
				disabled="false"
				id="eec6fd4ced1f461baaeed24ef025e0af"
				serviceId="nabu.utils.String.split"
				resultName="result0512353c1cc04863ae9f934d38f024bc"
				temporaryMapping="true"
				x="186"
				y="199"
				invocationOrder="0"
				asynchronous="false"
				recache="false">
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="d8cc0d83c76549958a280ca07cccf648"
					mask="false"
					optional="false"
					fixedValue="true">
				<from>RUNNING,ERROR</from>
				<to>string</to>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="d54a708fa241462f9dbf889bbcf1eb5c"
					mask="false"
					optional="false"
					fixedValue="true">
				<from>,</from>
				<to>separator</to>
			</steps>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Link"
				disabled="false"
				id="63c36404b47b40da8f32f855b8284d05"
				mask="false"
				optional="false"
				fixedValue="false">
			<from>result0512353c1cc04863ae9f934d38f024bc/parts</from>
			<to>runnableStates</to>
		</steps>
	</steps>
	<steps xsi:type="be.nabu.libs.services.vm.step.For"
			disabled="false"
			id="dce23007cf3b41da8e1f6655b0525a88"
			lineNumber="7"
			variable="potentialAction">
		<steps xsi:type="be.nabu.libs.services.vm.step.Map"
				comment="Get incoming relations and outgoing relations"
				disabled="false"
				id="bfc78793d44a4d868e2bd6badeab5b6a"
				lineNumber="8">
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="6f941ed3671f4685a91e2559b220b392"
					mask="false"
					optional="false"
					fixedValue="false">
				<from>potentialAction/relations[actionId == /potentialAction/id]</from>
				<to>outgoingFlows</to>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="5c71ccc096ac496ab0749b2611f163d0"
					mask="false"
					optional="false"
					fixedValue="false">
				<from>potentialAction/relations[targetActionId == /potentialAction/id]</from>
				<to>incomingFlows</to>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="14ca9e58ca1f49e2b937100037d2caa6"
					mask="false"
					optional="false"
					fixedValue="true">
				<from>true</from>
				<to>allowedToProceed</to>
			</steps>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Switch"
				disabled="false"
				id="6e764c7139194c27ade9b74935c5b1d8"
				lineNumber="9">
			<steps xsi:type="be.nabu.libs.services.vm.step.Map"
					comment="If we have no incoming flows and the state is marked as initial, we can start a new instance"
					disabled="false"
					id="df5be0d8de444a4d84aa08f71164acb4"
					label="incomingFlows == null &amp;&amp; potentialAction/state/initial == true"
					lineNumber="10">
				<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
						disabled="false"
						id="4983f94fd0794918822cac4d0eb0d794"
						serviceId="nabu.utils.Server.uuid"
						resultName="result1d8d12e1450e4cb4955fe2128374aa07"
						temporaryMapping="true"
						x="23"
						y="247"
						invocationOrder="0"
						asynchronous="false"
						recache="false">
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="4543596ca9a049dd9e9f4595d4c2cca9"
						mask="false"
						optional="false"
						fixedValue="false">
					<from>result1d8d12e1450e4cb4955fe2128374aa07/uuid</from>
					<to>potentialAction/newProcessInstanceId</to>
				</steps>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Sequence"
					disabled="false"
					id="91cd6941de3d4853b8ff8ea4212347a2"
					lineNumber="11">
				<steps xsi:type="be.nabu.libs.services.vm.step.Map"
						comment="Set the maxOccurs to 1 by default (makes it easier later)"
						disabled="false"
						id="6690f9744fbe4510a061b68d4232032a"
						label="potentialAction/maxOccurs == null"
						lineNumber="12">
					<steps xsi:type="be.nabu.libs.services.vm.step.Link"
							disabled="false"
							id="bf5d36a4f4234ae4ba8b28f25aff6b47"
							mask="false"
							optional="false"
							fixedValue="true">
						<from>1</from>
						<to>potentialAction/maxOccurs</to>
					</steps>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Switch"
						disabled="false"
						id="0fced93338a049d3bf25b09d12a35a7a"
						lineNumber="13"
						query="potentialAction/identificationType">
					<steps xsi:type="be.nabu.libs.services.vm.step.Map"
							disabled="false"
							id="4d009730bd7d4af2b1d39627878e347a"
							label="&quot;userId&quot;"
							lineNumber="14">
						<steps xsi:type="be.nabu.libs.services.vm.step.Link"
								disabled="false"
								id="376c675e138f4b0797a28bf84e360479"
								mask="false"
								optional="false"
								fixedValue="true">
							<from>userId</from>
							<to>identifiers[0]/key</to>
						</steps>
						<steps xsi:type="be.nabu.libs.services.vm.step.Link"
								disabled="false"
								id="e15dc53d1d3845e78f86718ec427b4cf"
								mask="false"
								optional="false"
								fixedValue="false">
							<from>input/token/authenticationId</from>
							<to>identifiers[0]/value</to>
						</steps>
					</steps>
					<steps xsi:type="be.nabu.libs.services.vm.step.Map"
							disabled="false"
							id="dcf7fb1eef2f4bcaa6bfe9816c814c5c"
							label="&quot;sessionId&quot;"
							lineNumber="15">
						<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
								disabled="false"
								id="f98e803c825445e7bb72c97ee4b65d92"
								serviceId="nabu.web.application.Services.getSessionId"
								resultName="resultba0e9a3e2d0941dc96658c5cb1d2c3dc"
								temporaryMapping="true"
								x="97"
								y="81"
								invocationOrder="0"
								asynchronous="false"
								recache="false">
						</steps>
						<steps xsi:type="be.nabu.libs.services.vm.step.Link"
								disabled="false"
								id="170c888d07574c03b8085bab9c20e21f"
								mask="false"
								optional="false"
								fixedValue="false">
							<from>resultba0e9a3e2d0941dc96658c5cb1d2c3dc/sessionId</from>
							<to>identifiers[0]/value</to>
						</steps>
						<steps xsi:type="be.nabu.libs.services.vm.step.Link"
								disabled="false"
								id="6cfdeb15bd874f209d1c2fca3939bef8"
								mask="false"
								optional="false"
								fixedValue="true">
							<from>sessionId</from>
							<to>identifiers[0]/key</to>
						</steps>
					</steps>
					<steps xsi:type="be.nabu.libs.services.vm.step.Map"
							disabled="false"
							id="e072fcb2553c421fab8b596027ccc34f"
							label="&quot;deviceId&quot;"
							lineNumber="16">
						<steps xsi:type="be.nabu.libs.services.vm.step.Link"
								disabled="false"
								id="f0c37039b2d5436891c6fdf4d885b4ab"
								mask="false"
								optional="false"
								fixedValue="false">
							<from>input/device/deviceId</from>
							<to>identifiers[0]/value</to>
						</steps>
						<steps xsi:type="be.nabu.libs.services.vm.step.Link"
								disabled="false"
								id="225c2de1bfa04073905fdaca166882d2"
								mask="false"
								optional="false"
								fixedValue="true">
							<from>deviceId</from>
							<to>identifiers[0]/key</to>
						</steps>
					</steps>
					<steps xsi:type="be.nabu.libs.services.vm.step.For"
							comment="If we are using custom identification, get all the identifiers in the input"
							disabled="false"
							id="687d5150e7264107a2404fe55a8e0f84"
							label="&quot;custom&quot;"
							lineNumber="17"
							variable="capture"
							into="identifiers">
						<steps xsi:type="be.nabu.libs.services.vm.step.Map"
								disabled="false"
								id="dd353f88c54342818f68797c95413894"
								lineNumber="18">
							<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
									disabled="false"
									id="ba88abc183b546b990fe69b81aebdaea"
									serviceId="nabu.services.glue.Services.evaluate"
									resultName="result39798cf79de545abb5aa50ae54ac1dcf"
									temporaryMapping="true"
									x="198"
									y="109"
									invocationOrder="0"
									asynchronous="false"
									recache="false">
								<steps xsi:type="be.nabu.libs.services.vm.step.Link"
										disabled="false"
										id="c2313aa1f0d34d67b2162b57027dcf83"
										mask="false"
										optional="false"
										fixedValue="false">
									<from>capture/capture</from>
									<to>rule</to>
								</steps>
							</steps>
							<steps xsi:type="be.nabu.libs.services.vm.step.Link"
									disabled="false"
									id="99330b2690a544029fa6510776f62658"
									mask="false"
									optional="false"
									fixedValue="false">
								<from>result39798cf79de545abb5aa50ae54ac1dcf/response</from>
								<to>identifiers[0]/value</to>
							</steps>
							<steps xsi:type="be.nabu.libs.services.vm.step.Link"
									disabled="false"
									id="ec1ad89c146940bf90ac05c64bb6ac94"
									mask="false"
									optional="false"
									fixedValue="false">
								<from>capture/name</from>
								<to>identifiers[0]/key</to>
							</steps>
						</steps>
						<query>potentialAction/captures[capture ~ "^input/.*" &amp;&amp; identifier == true]</query>
					</steps>
					<steps xsi:type="be.nabu.libs.services.vm.step.Map"
							disabled="false"
							id="6195455b091348cd9941358c732b89f5"
							lineNumber="19">
						<steps xsi:type="be.nabu.libs.services.vm.step.Link"
								disabled="false"
								id="ac17ef7da51b4f509213d2f26d66877e"
								mask="false"
								optional="false"
								fixedValue="true">
							<from>correlationId</from>
							<to>identifiers[0]/key</to>
						</steps>
						<steps xsi:type="be.nabu.libs.services.vm.step.Link"
								disabled="false"
								id="a351267c76d54f83aa53788c50c14807"
								mask="false"
								optional="false"
								fixedValue="false">
							<from>input/correlationId</from>
							<to>identifiers[0]/value</to>
						</steps>
					</steps>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Map"
						comment="Retain only identifiers with a value"
						disabled="false"
						id="3d3d779500954a3c9ec77131104ac311"
						lineNumber="20">
					<steps xsi:type="be.nabu.libs.services.vm.step.Link"
							disabled="false"
							id="9576ef9e26144e5c83f5a448932adac6"
							mask="false"
							optional="false"
							fixedValue="false">
						<from>identifiers[value != null]</from>
						<to>identifiers</to>
					</steps>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Sequence"
						comment="Only continue if we have active identifiers"
						disabled="false"
						id="03a03702e744452294fb2844341ea516"
						label="identifiers"
						lineNumber="21">
					<steps xsi:type="be.nabu.libs.services.vm.step.Map"
							disabled="false"
							id="eb6273958a0d4e06bf7108f529f31f2f"
							lineNumber="22">
						<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
								disabled="false"
								id="32bb56129493431b93c1633e049c0526"
								serviceId="nabu.frameworks.process.crud.processData.services.list"
								resultName="result7ea308e4bcd14ef88d2c0d51edf21180"
								temporaryMapping="true"
								x="189"
								y="53"
								invocationOrder="0"
								asynchronous="false"
								recache="false">
							<steps xsi:type="be.nabu.libs.services.vm.step.Link"
									disabled="false"
									id="0851b8c276e44b2a93891283e98c74db"
									mask="false"
									optional="false"
									fixedValue="false">
								<from>identifiers/value</from>
								<to>filter/value</to>
							</steps>
							<steps xsi:type="be.nabu.libs.services.vm.step.Link"
									disabled="false"
									id="8b127970650b46d589b0ffc40086c72f"
									mask="false"
									optional="false"
									fixedValue="false">
								<from>potentialAction/process/id</from>
								<to>filter/processDefinitionId[0]</to>
							</steps>
							<steps xsi:type="be.nabu.libs.services.vm.step.Link"
									disabled="false"
									id="a1366e1075ba476ba22a9c41b0e9a553"
									mask="false"
									optional="false"
									fixedValue="false">
								<from>runnableStates</from>
								<to>filter/processState</to>
							</steps>
							<steps xsi:type="be.nabu.libs.services.vm.step.Link"
									disabled="false"
									id="4949c3d0e4a44b418e7a6af75590da08"
									mask="false"
									optional="false"
									fixedValue="true">
								<from>true</from>
								<to>filter/identifier</to>
							</steps>
						</steps>
						<steps xsi:type="be.nabu.libs.services.vm.step.Link"
								disabled="false"
								id="4da5fcfec1344b18be80745c2e513619"
								mask="false"
								optional="false"
								fixedValue="false">
							<from>result7ea308e4bcd14ef88d2c0d51edf21180/results</from>
							<to>processDataInstances</to>
						</steps>
						<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
								disabled="false"
								id="9874e7cc4d3b42fcb543d4f7fcea5026"
								serviceId="nabu.utils.List.size"
								resultName="result6dc2b683f49a43e1b561839563fc019d"
								temporaryMapping="true"
								x="161"
								y="208"
								invocationOrder="0"
								asynchronous="false"
								recache="false">
							<steps xsi:type="be.nabu.libs.services.vm.step.Link"
									disabled="false"
									id="ea15ab2ede8e42188eb8dc4c73706b36"
									mask="false"
									optional="false"
									fixedValue="false">
								<from>identifiers</from>
								<to>list</to>
							</steps>
						</steps>
						<steps xsi:type="be.nabu.libs.services.vm.step.Link"
								disabled="false"
								id="bcd4a07ba9af4a5da0fd71bfff84664b"
								mask="false"
								optional="false"
								fixedValue="false">
							<from>result6dc2b683f49a43e1b561839563fc019d/size</from>
							<to>amountOfIdentifiers</to>
						</steps>
					</steps>
					<steps xsi:type="be.nabu.libs.services.vm.step.Sequence"
							comment="If we have multiple identifiers, only use processes that match _all_ identifiers"
							disabled="false"
							id="b68bc296f52c48cbba589f3180bcbace"
							label="amountOfIdentifiers &gt;= 2"
							lineNumber="23">
						<steps xsi:type="be.nabu.libs.services.vm.step.Map"
								comment="Group the results, we only want process instances that match _all_ identifiers"
								disabled="false"
								id="f13557d656594e9fb5ffca27b725e888"
								lineNumber="24">
							<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
									disabled="false"
									id="ddd353efa52240fea87a41f3b073d521"
									serviceId="nabu.utils.List.group"
									resultName="result3cca4c49166b4c3dbcb41b09c5d14521"
									temporaryMapping="true"
									x="30"
									y="46"
									invocationOrder="0"
									asynchronous="false"
									recache="false">
								<steps xsi:type="be.nabu.libs.services.vm.step.Link"
										disabled="false"
										id="4e8f44cf988d4958bfa75ddc918b0964"
										mask="false"
										optional="false"
										fixedValue="false">
									<from>processDataInstances</from>
									<to>list</to>
								</steps>
								<steps xsi:type="be.nabu.libs.services.vm.step.Link"
										disabled="false"
										id="a76c0e9986134ef893ed9c77417c0360"
										mask="false"
										optional="false"
										fixedValue="true">
									<from>nabu.frameworks.process.providers.action.service.utils.groupedProcessData</from>
									<to>definition</to>
								</steps>
							</steps>
							<steps xsi:type="be.nabu.libs.services.vm.step.Link"
									disabled="false"
									id="ed47788f8f754bd2b39faed8d7e985d0"
									mask="false"
									optional="false"
									fixedValue="false">
								<from>result3cca4c49166b4c3dbcb41b09c5d14521/response</from>
								<to>groupedProcessDataInstances</to>
							</steps>
							<steps xsi:type="be.nabu.libs.services.vm.step.Drop"
									disabled="false"
									id="cec365d62da2484aa32e450339dbef23"
									path="processDataInstances" xsi:nil="true"/>
						</steps>
						<steps xsi:type="be.nabu.libs.services.vm.step.For"
								disabled="false"
								id="aa45572e4e23485aaf3ab9e7447e7724"
								lineNumber="25"
								variable="groupedProcessDataInstance"
								into="processDataInstances">
							<steps xsi:type="be.nabu.libs.services.vm.step.Map"
									disabled="false"
									id="177f8e36cf054cd9a1ae784c7100165d"
									lineNumber="26">
								<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
										disabled="false"
										id="62dd4044dcdb4747ba33b3e6dc391cc2"
										serviceId="nabu.utils.List.size"
										resultName="result17eabe7f1b5c42c5992d3929a1014aef"
										temporaryMapping="true"
										x="77"
										y="70"
										invocationOrder="0"
										asynchronous="false"
										recache="false">
									<steps xsi:type="be.nabu.libs.services.vm.step.Link"
											disabled="false"
											id="be37289baee8470095977661c6e4ef2b"
											mask="false"
											optional="false"
											fixedValue="false">
										<from>groupedProcessDataInstance/processDataInstances</from>
										<to>list</to>
									</steps>
								</steps>
								<steps xsi:type="be.nabu.libs.services.vm.step.Link"
										disabled="false"
										id="c24295dff97345dbb07ad8a5b915d3c4"
										mask="false"
										optional="false"
										fixedValue="false">
									<from>result17eabe7f1b5c42c5992d3929a1014aef/size</from>
									<to>amountOfDataMatches</to>
								</steps>
							</steps>
							<steps xsi:type="be.nabu.libs.services.vm.step.Map"
									comment="We could just take the first one, but for now we take all matching, we filter further down"
									disabled="false"
									id="57a9529a28834dc3b670450363586fef"
									label="amountOfDataMatches == amountOfIdentifiers"
									lineNumber="27">
								<steps xsi:type="be.nabu.libs.services.vm.step.Link"
										disabled="false"
										id="1ab967427a0f49ac9d87a5ec70464a1d"
										mask="false"
										optional="false"
										fixedValue="false">
									<from>groupedProcessDataInstance/processDataInstances</from>
									<to>processDataInstances</to>
								</steps>
							</steps>
							<query>groupedProcessDataInstances</query>
						</steps>
					</steps>
					<steps xsi:type="be.nabu.libs.services.vm.step.For"
							disabled="false"
							id="bc8f44c6afd84005be15d141e9b5ee9b"
							lineNumber="28"
							variable="processDataInstance">
						<steps xsi:type="be.nabu.libs.services.vm.step.Sequence"
								disabled="false"
								id="8b06f5d9d05249979c6abcdfb518b154"
								label="processDataInstance/processInstanceId !# checkedProcessInstanceIds"
								lineNumber="29">
							<steps xsi:type="be.nabu.libs.services.vm.step.Throw"
									comment="Check that we are in the correct state"
									description="=&quot;Process &quot; + potentialAction/process/name + &quot; with id &quot; + processDataInstance/processInstanceId + &quot; is not in correct state to execute the service: &quot; + input/name"
									disabled="false"
									id="fc4d1c2841cb4c19a6784dbcd467ce1c"
									label="processDataInstance/currentStateId != potentialAction/processStateId &amp;&amp; potentialAction/lax != true"
									lineNumber="30"
									code="PROCESS-STATE-INCORRECT"
									message="Process not in correct state to execute this service" xsi:nil="true"/>
							<steps xsi:type="be.nabu.libs.services.vm.step.Map"
									comment="Add to the list of checked"
									disabled="false"
									id="f355c91d70214c46bcfdb719c0e1adf3"
									lineNumber="31">
								<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
										disabled="false"
										id="a524fc0b12724fea950237657757e3fd"
										serviceId="nabu.utils.List.add"
										resultName="result6fa05fd2d00546f3a0d8397b492c69b9"
										temporaryMapping="true"
										x="65"
										y="125"
										invocationOrder="0"
										asynchronous="false"
										recache="false">
									<steps xsi:type="be.nabu.libs.services.vm.step.Link"
											disabled="false"
											id="baa319682e83414e8d3649b6cbf9b7ed"
											mask="false"
											optional="false"
											fixedValue="false">
										<from>checkedProcessInstanceIds</from>
										<to>list</to>
									</steps>
									<steps xsi:type="be.nabu.libs.services.vm.step.Link"
											disabled="false"
											id="fd83482dad6f4cbbbe01812a885c5a77"
											mask="false"
											optional="false"
											fixedValue="false">
										<from>processDataInstance/processInstanceId</from>
										<to>object</to>
									</steps>
								</steps>
								<steps xsi:type="be.nabu.libs.services.vm.step.Link"
										disabled="false"
										id="201cd8accd704f159bf60631cf5c967d"
										mask="false"
										optional="false"
										fixedValue="false">
									<from>result6fa05fd2d00546f3a0d8397b492c69b9/list</from>
									<to>checkedProcessInstanceIds</to>
								</steps>
							</steps>
							<steps xsi:type="be.nabu.libs.services.vm.step.Sequence"
									comment="This process only matters if we _are_ in the correct state"
									disabled="false"
									id="3c520388d8354854a72d5ec6ae1caecb"
									label="processDataInstance/currentStateId == potentialAction/processStateId"
									lineNumber="32">
								<steps xsi:type="be.nabu.libs.services.vm.step.Map"
										comment="Get all the related action instances for this process instance"
										disabled="false"
										id="3d46cc2fb3c44d4eb8f1d8f462aaf683"
										lineNumber="33">
									<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
											disabled="false"
											id="e8cee927c2d6412a9fa0b2d07e5a95cc"
											serviceId="nabu.utils.List.addAll"
											resultName="resultc227324d99cb4da09e66eff1ccffc101"
											temporaryMapping="true"
											x="22"
											y="136"
											invocationOrder="0"
											asynchronous="false"
											recache="false">
										<steps xsi:type="be.nabu.libs.services.vm.step.Link"
												disabled="false"
												id="efc8516f499b4cdbb489a836c6c98115"
												mask="false"
												optional="false"
												fixedValue="false">
											<from>potentialAction/relations/targetActionId</from>
											<to>list</to>
										</steps>
										<steps xsi:type="be.nabu.libs.services.vm.step.Link"
												disabled="false"
												id="7ae7e1b000e34a7d82c9983f4f98b607"
												mask="false"
												optional="false"
												fixedValue="false">
											<from>potentialAction/relations/actionId</from>
											<to>objects</to>
										</steps>
									</steps>
									<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
											disabled="false"
											id="a3aea7acc2f1479db2b04ab2ae8dfbe7"
											serviceId="nabu.utils.List.unique"
											resultName="resulta010982be9ba4ef9b38ee4a035c0a018"
											temporaryMapping="true"
											x="265"
											y="307"
											invocationOrder="1"
											asynchronous="false"
											recache="false">
										<steps xsi:type="be.nabu.libs.services.vm.step.Link"
												disabled="false"
												id="1cdc2b2d1938424dbc9772687f952a1b"
												mask="false"
												optional="false"
												fixedValue="false">
											<from>resultc227324d99cb4da09e66eff1ccffc101/list</from>
											<to>list</to>
										</steps>
									</steps>
									<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
											disabled="false"
											id="e49ed47c0b8646d8976baf008f11a15f"
											serviceId="nabu.frameworks.process.crud.processActionInstance.services.list"
											resultName="result7ba151e534b847cf8c1df4e3f492a6fd"
											temporaryMapping="true"
											x="519"
											y="44"
											invocationOrder="2"
											asynchronous="false"
											recache="false">
										<steps xsi:type="be.nabu.libs.services.vm.step.Link"
												disabled="false"
												id="feebcea7a97b4ae3a9c8764055a33198"
												mask="false"
												optional="false"
												fixedValue="false">
											<from>resulta010982be9ba4ef9b38ee4a035c0a018/list</from>
											<to>filter/processActionId</to>
										</steps>
										<steps xsi:type="be.nabu.libs.services.vm.step.Link"
												disabled="false"
												id="24081be8035a468c882c93ed47987a43"
												mask="false"
												optional="false"
												fixedValue="false">
											<from>processDataInstance/processInstanceId</from>
											<to>filter/processInstanceId[0]</to>
										</steps>
									</steps>
									<steps xsi:type="be.nabu.libs.services.vm.step.Link"
											disabled="false"
											id="f7f72defffa94a6f926c56656349aa94"
											mask="false"
											optional="false"
											fixedValue="false">
										<from>result7ba151e534b847cf8c1df4e3f492a6fd/results</from>
										<to>relatedActionInstances</to>
									</steps>
									<steps xsi:type="be.nabu.libs.services.vm.step.Link"
											disabled="false"
											id="983a5c338a1e48268230bdf3d26a6689"
											mask="false"
											optional="false"
											fixedValue="true">
										<from>true</from>
										<to>allowedToProceed</to>
									</steps>
								</steps>
								<steps xsi:type="be.nabu.libs.services.vm.step.Sequence"
										comment="If we have incoming flow requirements, check that at least one is done"
										disabled="false"
										id="fb5c3769edcd42d187b1229fca0894c9"
										label="incomingFlows"
										lineNumber="34">
									<steps xsi:type="be.nabu.libs.services.vm.step.Map"
											comment="Get all finished incoming flows"
											disabled="false"
											id="96870e1120fd45c1b9a1d93866bec19e"
											lineNumber="35">
										<steps xsi:type="be.nabu.libs.services.vm.step.Link"
												disabled="false"
												id="eb022486ff4e4b698aa3fd81ad3823f1"
												mask="false"
												optional="false"
												fixedValue="false">
											<from>relatedActionInstances[processActionId # /incomingFlows/actionId]</from>
											<to>finishedIncomingActions</to>
										</steps>
									</steps>
									<steps xsi:type="be.nabu.libs.services.vm.step.Map"
											comment="Set the allowed based on the existence of any incoming finished flows"
											disabled="false"
											id="311991d695d94112b43d0222e86bb939"
											lineNumber="36">
										<steps xsi:type="be.nabu.libs.services.vm.step.Link"
												disabled="false"
												id="2b6efda150a2441a97a3aaea71089846"
												mask="false"
												optional="false"
												fixedValue="true">
											<from>=finishedIncomingActions != null</from>
											<to>allowedToProceed</to>
										</steps>
									</steps>
									<steps xsi:type="be.nabu.libs.services.vm.step.Sequence"
											comment="If we don't have any finished incoming actions, check the service context to see if we are actually running it now (parent)"
											disabled="false"
											id="8dcd0033d7344b42a374dabcaef11e05"
											label="!allowedToProceed"
											lineNumber="37">
										<steps xsi:type="be.nabu.libs.services.vm.step.Map"
												disabled="false"
												id="e366b0eaffbd4721b33dd94718171003"
												lineNumber="38">
											<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
													disabled="false"
													id="2ef527af4970454983a7dc9d837797ad"
													serviceId="nabu.utils.Runtime.getContext"
													resultName="result70c614dd50b2484bae275fd7c836016e"
													temporaryMapping="true"
													x="112"
													y="81"
													invocationOrder="0"
													asynchronous="false"
													recache="false">
												<steps xsi:type="be.nabu.libs.services.vm.step.Link"
														disabled="false"
														id="f783c218321a4c85be5ccac65a3e7433"
														mask="false"
														optional="false"
														fixedValue="true">
													<from>="planned-actions-" + actionToRun/process/id</from>
													<to>key</to>
												</steps>
											</steps>
											<steps xsi:type="be.nabu.libs.services.vm.step.Link"
													disabled="false"
													id="25c07fd0cbc1431b9a9bb59d898fbeba"
													mask="false"
													optional="false"
													fixedValue="false">
												<from>result70c614dd50b2484bae275fd7c836016e/value</from>
												<to>plannedActions</to>
											</steps>
										</steps>
										<steps xsi:type="be.nabu.libs.services.vm.step.Map"
												comment="Get planned actions that match the incoming flows"
												disabled="false"
												id="73fd2720291741c1b12b66e7d176dc35"
												lineNumber="39">
											<steps xsi:type="be.nabu.libs.services.vm.step.Link"
													disabled="false"
													id="83ce9aac92f841faae0d46cd84916664"
													mask="false"
													optional="false"
													fixedValue="false">
												<from>plannedActions[id # /incomingFlows/actionId]</from>
												<to>plannedActions</to>
											</steps>
										</steps>
										<steps xsi:type="be.nabu.libs.services.vm.step.Map"
												comment="Recalculate allowed to proceed"
												disabled="false"
												id="259b7374076848429f0dbc2e81f747f8"
												lineNumber="40">
											<steps xsi:type="be.nabu.libs.services.vm.step.Link"
													disabled="false"
													id="19d0d7f086ab445795bf6c56f98a3c0c"
													mask="false"
													optional="false"
													fixedValue="true">
												<from>=plannedActions != null</from>
												<to>allowedToProceed</to>
											</steps>
										</steps>
									</steps>
								</steps>
								<steps xsi:type="be.nabu.libs.services.vm.step.Sequence"
										comment="If we have outgoing flow requirements, check that none are done"
										disabled="false"
										id="fda7117a3eb84734a73e0c8551b3efbc"
										label="allowedToProceed &amp;&amp; outgoingFlows != null"
										lineNumber="41">
									<steps xsi:type="be.nabu.libs.services.vm.step.Map"
											comment="Get all finished outgoing flows"
											disabled="false"
											id="6a4071ae36a74389be4337d144216ab0"
											lineNumber="42">
										<steps xsi:type="be.nabu.libs.services.vm.step.Link"
												disabled="false"
												id="65e805731dc04f7daf05c78bd65a1928"
												mask="false"
												optional="false"
												fixedValue="false">
											<from>relatedActionInstances[processActionId # /outgoingFlows/targetActionId]</from>
											<to>finishedOutgoingActions</to>
										</steps>
									</steps>
									<steps xsi:type="be.nabu.libs.services.vm.step.Map"
											comment="Set the allowed based on the existence of NO outgoing flows"
											disabled="false"
											id="78f11741d0a14ee79c9276449c055293"
											lineNumber="43">
										<steps xsi:type="be.nabu.libs.services.vm.step.Link"
												disabled="false"
												id="6ea21b540f464fb3be3afd27aa3baac7"
												mask="false"
												optional="false"
												fixedValue="true">
											<from>=finishedOutgoingActions == null</from>
											<to>allowedToProceed</to>
										</steps>
									</steps>
								</steps>
								<steps xsi:type="be.nabu.libs.services.vm.step.Sequence"
										comment="Check that the action itself has not yet been executed OR that it has a maxoccurs that allows for it. Maxoccurs = 0 means infinite times"
										disabled="false"
										id="06b8ea8304524479a80b64044bfaceb7"
										label="allowedToProceed &amp;&amp; potentialAction/maxOccurs != 0"
										lineNumber="44">
									<steps xsi:type="be.nabu.libs.services.vm.step.Map"
											comment="We ignore failed for this count"
											disabled="false"
											id="ba00e6cb7e6e46d9ae7e1c626d76a190"
											lineNumber="45">
										<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
												disabled="false"
												id="cf7999ab1a8d4781bafd97188079f6ee"
												serviceId="nabu.utils.List.size"
												resultName="resulted0c77eec28a418eac5af898c978faee"
												temporaryMapping="true"
												x="151"
												y="127"
												invocationOrder="0"
												asynchronous="false"
												recache="false">
											<steps xsi:type="be.nabu.libs.services.vm.step.Link"
													disabled="false"
													id="5224b55150674af5b134097ed179231a"
													mask="false"
													optional="false"
													fixedValue="false">
												<from>relatedActionInstances[processActionId == /potentialAction/id &amp;&amp; processState != "FAILED"]</from>
												<to>list</to>
											</steps>
										</steps>
										<steps xsi:type="be.nabu.libs.services.vm.step.Link"
												disabled="false"
												id="a02cf93b401e416aaee7ac6cafe4da3c"
												mask="false"
												optional="false"
												fixedValue="false">
											<from>resulted0c77eec28a418eac5af898c978faee/size</from>
											<to>amountOfTimesRun</to>
										</steps>
									</steps>
									<steps xsi:type="be.nabu.libs.services.vm.step.Map"
											comment="Set the allowed to proceed based on the count"
											disabled="false"
											id="1d3b394314cc49a788b9e9e4f64b50d6"
											lineNumber="46">
										<steps xsi:type="be.nabu.libs.services.vm.step.Link"
												disabled="false"
												id="891a21fc1f89456aab90129fe3613cc8"
												mask="false"
												optional="false"
												fixedValue="true">
											<from>=amountOfTimesRun &lt; potentialAction/maxOccurs</from>
											<to>allowedToProceed</to>
										</steps>
									</steps>
								</steps>
								<steps xsi:type="be.nabu.libs.services.vm.step.Throw"
										description="=&quot;Process &quot; + potentialAction/process/name + &quot; with id &quot; + processDataInstance/processInstanceId + &quot; is not in correct state to execute the service: &quot; + input/name"
										disabled="false"
										id="35be90f53c174ccb911cc20582050e7a"
										label="!allowedToProceed &amp;&amp; potentialAction/lax != true"
										lineNumber="47"
										code="PROCESS-STATE-INCORRECT"
										message="Process not in correct state to execute this service" xsi:nil="true"/>
								<steps xsi:type="be.nabu.libs.services.vm.step.Map"
										comment="Add it to the list"
										disabled="false"
										id="86521b1bc8a34626954144810d36b257"
										label="allowedToProceed"
										lineNumber="48">
									<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
											disabled="false"
											id="37af9959e193471482a6753e1c29acc0"
											serviceId="nabu.utils.List.add"
											resultName="resultfcf9edafa7db4f48b99d8bffcc5ac963"
											temporaryMapping="true"
											x="145"
											y="61"
											invocationOrder="0"
											asynchronous="false"
											recache="false">
										<steps xsi:type="be.nabu.libs.services.vm.step.Link"
												disabled="false"
												id="f8796f88031f488d901972dd229d557e"
												mask="false"
												optional="false"
												fixedValue="false">
											<from>potentialAction/processInstanceIds</from>
											<to>list</to>
										</steps>
										<steps xsi:type="be.nabu.libs.services.vm.step.Link"
												disabled="false"
												id="8e61f69947e340a19351e159d9e4eca0"
												mask="false"
												optional="false"
												fixedValue="false">
											<from>processDataInstance/processInstanceId</from>
											<to>object</to>
										</steps>
									</steps>
									<steps xsi:type="be.nabu.libs.services.vm.step.Link"
											disabled="false"
											id="10d60faa2acd4e2392e028f48ebd9118"
											mask="false"
											optional="false"
											fixedValue="false">
										<from>resultfcf9edafa7db4f48b99d8bffcc5ac963/list</from>
										<to>potentialAction/processInstanceIds</to>
									</steps>
								</steps>
							</steps>
						</steps>
						<query>processDataInstances</query>
					</steps>
					<steps xsi:type="be.nabu.libs.services.vm.step.Sequence"
							comment="If there are no process data instances (yet), we might have an instance of the process started in this thread. We don't check identifiers at that point!"
							disabled="false"
							id="30e2290e80074359a941d77e4f92cdbe"
							label="!processDataInstances"
							lineNumber="49">
						<steps xsi:type="be.nabu.libs.services.vm.step.Map"
								disabled="false"
								id="240f50de7a3e4ad59e22433608d9e891"
								lineNumber="50">
							<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
									disabled="false"
									id="5973b6c55b834b07b1ce7f8044eb70f2"
									serviceId="nabu.utils.Runtime.getContext"
									resultName="resulte1f172fa6eac4434bf2a70fa307943ce"
									temporaryMapping="true"
									x="180"
									y="59"
									invocationOrder="0"
									asynchronous="false"
									recache="false">
								<steps xsi:type="be.nabu.libs.services.vm.step.Link"
										disabled="false"
										id="093b0c2706224aeb97e52da74cbf968e"
										mask="false"
										optional="false"
										fixedValue="true">
									<from>="planned-actions-" + actionToRun/process/id</from>
									<to>key</to>
								</steps>
							</steps>
							<steps xsi:type="be.nabu.libs.services.vm.step.Link"
									disabled="false"
									id="62a719ae6bbb4eac96c4210c55fe69e5"
									mask="false"
									optional="false"
									fixedValue="false">
								<from>resulte1f172fa6eac4434bf2a70fa307943ce/value</from>
								<to>plannedActions</to>
							</steps>
						</steps>
						<steps xsi:type="be.nabu.libs.services.vm.step.Map"
								disabled="false"
								id="9110d68058264c0aaa407631c5203f1a"
								lineNumber="51">
							<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
									disabled="false"
									id="60b551e0313d40639d9fe65f19dfc3b0"
									serviceId="nabu.utils.Object.first"
									resultName="result03849b3cf05b41b5b469d1342f2a5da7"
									temporaryMapping="true"
									x="129"
									y="343"
									invocationOrder="0"
									asynchronous="false"
									recache="false">
								<steps xsi:type="be.nabu.libs.services.vm.step.Link"
										disabled="false"
										id="38697424a44d4a179d2f99d06fa1ff23"
										mask="false"
										optional="false"
										fixedValue="false">
									<from>plannedActions/newProcessInstanceId</from>
									<to>options</to>
								</steps>
							</steps>
							<steps xsi:type="be.nabu.libs.services.vm.step.Link"
									disabled="false"
									id="8e435df2a8af4d23a0a8f516e1e1f502"
									mask="false"
									optional="false"
									fixedValue="false">
								<from>result03849b3cf05b41b5b469d1342f2a5da7/first</from>
								<to>newProcessInstanceId</to>
							</steps>
						</steps>
						<steps xsi:type="be.nabu.libs.services.vm.step.Map"
								disabled="false"
								id="899214f4b545468abbef1999e84f61ea"
								label="newProcessInstanceId != null"
								lineNumber="52">
							<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
									disabled="false"
									id="8f8d9bbcebed42448bddf5fafdc43c99"
									serviceId="nabu.utils.List.add"
									resultName="resultb8924ab8fa1b4cca89198501e3d19621"
									temporaryMapping="true"
									x="112"
									y="161"
									invocationOrder="0"
									asynchronous="false"
									recache="false">
								<steps xsi:type="be.nabu.libs.services.vm.step.Link"
										disabled="false"
										id="0cbb7c341b90476fbd73351f94d15c38"
										mask="false"
										optional="false"
										fixedValue="false">
									<from>potentialAction/processInstanceIds</from>
									<to>list</to>
								</steps>
								<steps xsi:type="be.nabu.libs.services.vm.step.Link"
										disabled="false"
										id="d65e8422eb09428e8d30fa8dd01eee28"
										mask="false"
										optional="false"
										fixedValue="false">
									<from>newProcessInstanceId</from>
									<to>object</to>
								</steps>
							</steps>
							<steps xsi:type="be.nabu.libs.services.vm.step.Link"
									disabled="false"
									id="705f5b538d144177aa4bc42697521f1a"
									mask="false"
									optional="false"
									fixedValue="false">
								<from>resultb8924ab8fa1b4cca89198501e3d19621/list</from>
								<to>potentialAction/processInstanceIds</to>
							</steps>
						</steps>
					</steps>
				</steps>
			</steps>
		</steps>
		<query>output/actionsToRun</query>
	</steps>
	<steps xsi:type="be.nabu.libs.services.vm.step.Map"
			comment="Only retain actions that actually have processes linked to it"
			disabled="false"
			id="f50d153c23e94d0d8ce652338c9ecc8b"
			lineNumber="53">
		<steps xsi:type="be.nabu.libs.services.vm.step.Link"
				disabled="false"
				id="37a34d9a3e864e2098e8ce619f8b4611"
				mask="false"
				optional="false"
				fixedValue="false">
			<from>output/actionsToRun[processInstanceIds != null || newProcessInstanceId != null]</from>
			<to>output/actionsToRun</to>
		</steps>
	</steps>
	<steps xsi:type="be.nabu.libs.services.vm.step.For"
			comment="If we have actions to run, save it to service context so we can lookup when nesting services"
			disabled="false"
			id="ae5e0c16704141d1909c08c7df57563b"
			lineNumber="54"
			variable="actionToRun">
		<steps xsi:type="be.nabu.libs.services.vm.step.Map"
				disabled="false"
				id="f78ac3588c19461d9bc316adfe077897"
				lineNumber="55">
			<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
					disabled="false"
					id="87cc5c7c1acf45f9adc9923c1bde1d79"
					serviceId="nabu.utils.Runtime.getContext"
					resultName="result75bf43b69cf7479bb44f4fc18255a70d"
					temporaryMapping="true"
					x="166"
					y="104"
					invocationOrder="0"
					asynchronous="false"
					recache="false">
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="8433a341a52041d08080fc2dfb4f06a1"
						mask="false"
						optional="false"
						fixedValue="true">
					<from>="planned-actions-" + actionToRun/process/id</from>
					<to>key</to>
				</steps>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="605461fb5a524677ab1918e061e9c4ee"
					mask="false"
					optional="false"
					fixedValue="false">
				<from>result75bf43b69cf7479bb44f4fc18255a70d/value</from>
				<to>plannedActions</to>
			</steps>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Map"
				disabled="false"
				id="78843fc07fc34472aff0676f21b833dd"
				lineNumber="56">
			<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
					disabled="false"
					id="47d5a105b3ba4d2e948aa71747eb6e98"
					serviceId="nabu.utils.List.add"
					resultName="resultff44f2d61b3b41629141885505f5ac22"
					temporaryMapping="true"
					x="107"
					y="128"
					invocationOrder="0"
					asynchronous="false"
					recache="false">
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="948b325ede0e427fa2fdb946cf12f95a"
						mask="false"
						optional="false"
						fixedValue="false">
					<from>plannedActions</from>
					<to>list</to>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="774c2eef570649f48ee3531829ec7baa"
						mask="false"
						optional="false"
						fixedValue="false">
					<from>actionToRun</from>
					<to>object</to>
				</steps>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="77884a60af474418bef6e7f991d45365"
					mask="false"
					optional="false"
					fixedValue="false">
				<from>resultff44f2d61b3b41629141885505f5ac22/list</from>
				<to>plannedActions</to>
			</steps>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Map"
				disabled="false"
				id="9aedc9aece8341a5a883913e1a993ba4"
				lineNumber="57">
			<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
					disabled="false"
					id="c6a93a0273c843b2b5e12484c38ba704"
					serviceId="nabu.utils.Runtime.setContext"
					resultName="resulte27ad69f0bbc45e1ba37ef52f8f299f7"
					temporaryMapping="true"
					x="108"
					y="114"
					invocationOrder="0"
					asynchronous="false"
					recache="false">
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="3bb8cb98188c42b9a5d162ce4638145d"
						mask="false"
						optional="false"
						fixedValue="true">
					<from>="planned-actions-" + actionToRun/process/id</from>
					<to>key</to>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="1c51899ee4ed45ddb50f9564f8144284"
						mask="false"
						optional="false"
						fixedValue="false">
					<from>plannedActions</from>
					<to>value</to>
				</steps>
			</steps>
		</steps>
		<query>output/actionsToRun</query>
	</steps>
</sequence>